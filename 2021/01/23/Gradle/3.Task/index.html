<!DOCTYPE html><html data-theme="light"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Task | Fan Blog</title><meta name="description" content="​"><meta name="keywords" content="Task"><meta name="author" content="Fan shanhong"><meta name="copyright" content="Fan shanhong"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Task"><meta name="twitter:description" content="​"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="Task"><meta property="og:url" content="http://yoursite.com/2021/01/23/Gradle/3.Task/"><meta property="og:site_name" content="Fan Blog"><meta property="og:description" content="​"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2021/01/23/Gradle/3.Task/"><link rel="prev" title="Project" href="http://yoursite.com/2021/01/23/Gradle/4.Project/"><link rel="next" title href="http://yoursite.com/2020/12/17/Metadata说明/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Fan Blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">142</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">32</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">29</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">Catalog</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#创建Task"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">创建Task</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#任务依赖"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">任务依赖</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Task-配置阶段"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">Task 配置阶段</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Gradle-生命周期"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">Gradle 生命周期</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#lt-lt-操作"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">&lt;&lt; 操作</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#创建Task的几种常见写法"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">创建Task的几种常见写法</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#创建Task的参数介绍"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">创建Task的参数介绍</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#通过任务名来操作任务"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">通过任务名来操作任务</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Task-Interface"><span class="toc_mobile_items-number">9.</span> <span class="toc_mobile_items-text">Task Interface</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#TaskContainer接口解析"><span class="toc_mobile_items-number">10.</span> <span class="toc_mobile_items-text">TaskContainer接口解析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Task增量构建"><span class="toc_mobile_items-number">11.</span> <span class="toc_mobile_items-text">Task增量构建</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#TaskInputs、TaskOutputs"><span class="toc_mobile_items-number">11.1.</span> <span class="toc_mobile_items-text">TaskInputs、TaskOutputs</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#taskInputs、taskOutputs注解"><span class="toc_mobile_items-number">11.2.</span> <span class="toc_mobile_items-text">taskInputs、taskOutputs注解</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#任务排序"><span class="toc_mobile_items-number">12.</span> <span class="toc_mobile_items-text">任务排序</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#任务启用和禁用"><span class="toc_mobile_items-number">13.</span> <span class="toc_mobile_items-text">任务启用和禁用</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#任务的onlyIf"><span class="toc_mobile_items-number">14.</span> <span class="toc_mobile_items-text">任务的onlyIf</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#创建Task"><span class="toc-number">1.</span> <span class="toc-text">创建Task</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#任务依赖"><span class="toc-number">2.</span> <span class="toc-text">任务依赖</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Task-配置阶段"><span class="toc-number">3.</span> <span class="toc-text">Task 配置阶段</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Gradle-生命周期"><span class="toc-number">4.</span> <span class="toc-text">Gradle 生命周期</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-lt-操作"><span class="toc-number">5.</span> <span class="toc-text">&lt;&lt; 操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#创建Task的几种常见写法"><span class="toc-number">6.</span> <span class="toc-text">创建Task的几种常见写法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#创建Task的参数介绍"><span class="toc-number">7.</span> <span class="toc-text">创建Task的参数介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#通过任务名来操作任务"><span class="toc-number">8.</span> <span class="toc-text">通过任务名来操作任务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Task-Interface"><span class="toc-number">9.</span> <span class="toc-text">Task Interface</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TaskContainer接口解析"><span class="toc-number">10.</span> <span class="toc-text">TaskContainer接口解析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Task增量构建"><span class="toc-number">11.</span> <span class="toc-text">Task增量构建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TaskInputs、TaskOutputs"><span class="toc-number">11.1.</span> <span class="toc-text">TaskInputs、TaskOutputs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#taskInputs、taskOutputs注解"><span class="toc-number">11.2.</span> <span class="toc-text">taskInputs、taskOutputs注解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#任务排序"><span class="toc-number">12.</span> <span class="toc-text">任务排序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#任务启用和禁用"><span class="toc-number">13.</span> <span class="toc-text">任务启用和禁用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#任务的onlyIf"><span class="toc-number">14.</span> <span class="toc-text">任务的onlyIf</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">Task</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> Created 2021-01-23<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> Updated 2021-01-28</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Task/">Task</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>Post View:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><!-- TOC -->
<ul>
<li><a href="#创建task">创建Task</a></li>
<li><a href="#任务依赖">任务依赖</a></li>
<li><a href="#task-配置阶段">Task 配置阶段</a></li>
<li><a href="#gradle-生命周期">Gradle 生命周期</a></li>
<li><a href="#-操作">&lt;&lt; 操作</a></li>
<li><a href="#创建task的几种常见写法">创建Task的几种常见写法</a></li>
<li><a href="#创建task的参数介绍">创建Task的参数介绍</a></li>
<li><a href="#通过任务名来操作任务">通过任务名来操作任务</a></li>
<li><a href="#task-interface">Task Interface</a></li>
<li><a href="#taskcontainer接口解析">TaskContainer接口解析</a></li>
<li><a href="#task增量构建">Task增量构建</a><ul>
<li><a href="#taskinputstaskoutputs">TaskInputs、TaskOutputs</a></li>
<li><a href="#taskinputstaskoutputs注解">taskInputs、taskOutputs注解</a></li>
</ul>
</li>
<li><a href="#任务排序">任务排序</a></li>
<li><a href="#任务启用和禁用">任务启用和禁用</a></li>
<li><a href="#任务的onlyif">任务的onlyIf</a></li>
</ul>
<!-- /TOC -->
<h1 id="创建Task"><a href="#创建Task" class="headerlink" title="创建Task"></a>创建Task</h1><p>创建一个Task 非常简单</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">task hello &#123;</span><br><span class="line"></span><br><span class="line">    doFirst &#123;</span><br><span class="line">        println <span class="string">"hello::doFirst"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">"hello::doFirst"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>这里的task看着像关键字，其实他是 project对象的一个函数。原型是：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">task(String taskName, Closure configureClosue)</span><br></pre></td></tr></table></figure></div>
<p>那正常调用方法的时候，我们应该是这样写的：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">project.task(<span class="string">"hello"</span>, &#123;</span><br><span class="line">    <span class="comment">// 任务做的操作，比如doFirst，doLast</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
<p>这个project对象，其实就是当前的 build.gradle，也就是当前的工程对象，因为Gradle在初始化的时候，Gradle为每个项目创建一个Project实例。</p>
<p>这里我们调用project对象的task()方法。第一个参数指定Task的名称，第二个参数是个闭包，用于对创建的任务进行配置。</p>
<p>根据Groovy的规定，当最后一个参数是闭包的时候，可以拿到括号外面，就成了下面这样。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">project.task(<span class="string">"hello"</span>)&#123;</span><br><span class="line">    <span class="comment">// 任务做的操作，比如doFirst，doLast</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>然后方法调用，括号可以不写。同时，调用project的方法或者属性，project也可以省略，就成了下面的模样。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">task <span class="string">"hello"</span> &#123;</span><br><span class="line">    <span class="comment">// 任务做的操作，比如doFirst，doLast</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>最终，字符串双引号也麻烦，省略吧。</p>
<p>在闭包里面执行的  doFirst 和 doLast， 都是Task的方法。原型：doFirst(Closure action)<br>因此，最最完整，可能是这样的吧：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">project.task(<span class="string">"hello"</span>, &#123;</span><br><span class="line">    hello.doFirst(&#123;&#125;)</span><br><span class="line">    hello.doLast(&#123;&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
<p>doFirst 方法是在任务执行前执行的。<br>doLast 方法是在任务执行后执行的。</p>
<p>那任务执行是什么？ Action。action：指执行阶段被运行的代码块。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrintVersion</span> <span class="keyword">extends</span> <span class="title">DefaultTask</span>&#123;</span></span><br><span class="line">    <span class="meta">@TaskAction</span></span><br><span class="line">    <span class="keyword">void</span> start()&#123;</span><br><span class="line">        println(<span class="string">"on action"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>然后通过type来指定。</p>
<h1 id="任务依赖"><a href="#任务依赖" class="headerlink" title="任务依赖"></a>任务依赖</h1><p>任务之间是可以有依赖关系的。通过dependsOn 来指定。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">task intro(<span class="string">dependsOn:</span> hello) &#123;</span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">"im Gradle"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>输出：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ShanhongdeiMac:helloworld shanhongfan$ gradlew intro</span><br><span class="line">Starting a Gradle Daemon (subsequent builds will be faster)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Configure project :</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Task :hello</span></span><br><span class="line">Hello world!</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Task :intro</span></span><br><span class="line">im Gradle</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL in 3s</span><br><span class="line">2 actionable tasks: 2 executed</span><br></pre></td></tr></table></figure></div>
<p>先执行 hello 任务，再执行 intro。</p>
<p>另外，一个任务也可以同时依赖多个任务；</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">task intro2 &#123;</span><br><span class="line">    dependsOn hello, intro</span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">"intro2"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>这里 dependsOn 是Task 类的一个方法，可以接收多个任务作为参数。<br>原型：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dependsOn(<span class="string">tasks:</span> Object...)</span><br></pre></td></tr></table></figure></div>
<h1 id="Task-配置阶段"><a href="#Task-配置阶段" class="headerlink" title="Task 配置阶段"></a>Task 配置阶段</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">task myTask1 &#123;</span><br><span class="line">    println <span class="string">"configure task1"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task myTask2 &#123;</span><br><span class="line">    println <span class="string">"configure task2"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>执行其中一个task：gradle myTask1</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> Configure project :</span></span><br><span class="line">configure task1</span><br><span class="line">configure task2</span><br></pre></td></tr></table></figure></div>
<p>上面定义了2个 task ：myTask1、myTask2，但是当我们执行 myTask1 时，发现2个 task 括号内部的代码都被执行了。括号内部的代码我们称之为配置代码，在 gradle 脚本的配置阶段都会执行，也就是说不管执行脚本里的哪个任务，所有 task 里的配置代码都会执行。</p>
<h1 id="Gradle-生命周期"><a href="#Gradle-生命周期" class="headerlink" title="Gradle 生命周期"></a>Gradle 生命周期</h1><p>Task 的运行与 Gradle 的生命周期息息相关，所以在此之前先介绍一下 Gradle 构建的生命周期，无论什么时候执行 Gradle 构建，都会依次运行三个不同的生命周期阶段：</p>
<ul>
<li><p>初始化<br>在初始化阶段，Gradle 会解析 setting.gradle 文件获取该项目包含几个子项目，然后创建一个 RootProject 以及分别为子项目创建 Project 实例。</p>
</li>
<li><p>配置<br>初始化完成后进入配置阶段，此时会加载所有 build.gradle 文件配置及插件，然后执行所有 Task 的配置代码块。</p>
</li>
<li><p>执行<br>执行指的就是依据顺序执行所有 Task 的动作。</p>
</li>
</ul>
<p>需要注意，无论我们是单独运行某一个 Task，还是运行所有的 Task，Gradle 的生命周期都是固定为上述的三个步骤，只不过执行的时候会有选择的执行指定 Task 及其依赖的 Task，这意味着如果一个 Task 设置了在配置阶段执行某项任务，即使我们运行了别的 Task，该任务也会被执行。</p>
<p><a href="https://cdn.jsdelivr.net/gh/fanshanhong/note-image/task.jpg" data-fancybox="group" data-caption class="fancybox"><img src="https://cdn.jsdelivr.net/gh/fanshanhong/note-image/task.jpg" alt title></a></p>
<h1 id="lt-lt-操作"><a href="#lt-lt-操作" class="headerlink" title="&lt;&lt; 操作"></a>&lt;&lt; 操作</h1><p>已废弃<br>参考：</p>
<p><a href="https://cdn.jsdelivr.net/gh/fanshanhong/note-image/gradle_%3C%3C_error.png" data-fancybox="group" data-caption class="fancybox"><img src="https://cdn.jsdelivr.net/gh/fanshanhong/note-image/gradle_%3C%3C_error.png" alt title></a></p>
<p><a href="https://cdn.jsdelivr.net/gh/fanshanhong/note-image/gradle_%3C%3C_solve.png" data-fancybox="group" data-caption class="fancybox"><img src="https://cdn.jsdelivr.net/gh/fanshanhong/note-image/gradle_%3C%3C_solve.png" alt title></a></p>
<h1 id="创建Task的几种常见写法"><a href="#创建Task的几种常见写法" class="headerlink" title="创建Task的几种常见写法"></a>创建Task的几种常见写法</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">task myTask1 &#123;</span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">"doLast in task1"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task myTask2 &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">"doLast in task2"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//采用 Project.task(String name) 方法来创建</span></span><br><span class="line">project.task(<span class="string">"myTask3"</span>).doLast &#123;</span><br><span class="line">    println <span class="string">"doLast in task3"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//采用 TaskContainer.create(String name) 方法来创建</span></span><br><span class="line">project.tasks.create(<span class="string">"myTask4"</span>).doLast &#123;</span><br><span class="line">    println <span class="string">"doLast in task4"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">project.tasks.create(<span class="string">"myTask5"</span>) &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">"doLast in task5"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h1 id="创建Task的参数介绍"><a href="#创建Task的参数介绍" class="headerlink" title="创建Task的参数介绍"></a>创建Task的参数介绍</h1><p>在 Gradle 中定义 Task 的时候，可以指定更多的参数，如下所示：<br>|  参数名   | 含义  | 默认值|<br>|  —-  | —-  | —-  |<br>|name    |task的名字    |必须指定，不能为空|<br>|type    |task的父类    |默认值为org.gradle.api.DefaultTask|<br>|overwrite    |是否替换已经存在的同名task    |false|<br>|group    |task所属的分组名    |null|<br>|description|    task的描述    |null|<br>|dependsOn    |task依赖的task集合    |无|<br>|constructorArgs|    构造函数参数|    无| </p>
<p>我们来测试下：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">task myTask1 &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">"doLast in task1"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task myTask2 &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">"doLast in task2"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task myTask3 &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">"doLast in task3, this is old task"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task myTask3(<span class="string">description:</span> <span class="string">"这是task3的描述"</span>, <span class="string">group:</span> <span class="string">"myTaskGroup"</span>, <span class="string">dependsOn:</span> [myTask1, myTask2], <span class="string">overwrite:</span> <span class="literal">true</span>) &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">"doLast in task3, this is new task"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>执行 gradle myTask3，结果如下：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> Task :myTask1</span></span><br><span class="line">doLast in task1</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Task :myTask2</span></span><br><span class="line">doLast in task2</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Task :myTask3</span></span><br><span class="line">doLast in task3, this is new task</span><br></pre></td></tr></table></figure></div></p>
<p>执行命令 gradle -q tasks –all，查看下 task 信息，节选我们创建的 task 信息如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MyTaskGroup tasks</span><br><span class="line">------------</span><br><span class="line">myTask3 - 这是task3的描述</span><br><span class="line"></span><br><span class="line">Other tasks</span><br><span class="line">-----------</span><br><span class="line">myTask1</span><br><span class="line">myTask2</span><br></pre></td></tr></table></figure></div>
<p>上面例子中创建了2个名为 myTask3 的 task，但是后一个将前一个替换掉了，在分组信息里多了个一个名为 MyTaskGroup 的分组，其他没有命名分组的统一归到 Other 这个分组里去了。</p>
<p>我们再来看看 type 参数怎么个用法，在 Gradle 中通过 task 关键字创建的 task，默认的父类都是 org.gradle.api.DefaultTask，这里定义了一些 task 的默认行为。看看下面这个例子：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义Task类，必须继承自DefaultTask</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SayHelloTask</span> <span class="keyword">extends</span> <span class="title">DefaultTask</span> &#123;</span></span><br><span class="line">    </span><br><span class="line">    String msg = <span class="string">"default name"</span></span><br><span class="line">    <span class="keyword">int</span> age = <span class="number">18</span>        </span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数必须用@javax.inject.Inject注解标识</span></span><br><span class="line">    <span class="meta">@javax</span>.inject.Inject</span><br><span class="line">    SayHelloTask(<span class="keyword">int</span> age) &#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过@TaskAction注解来标识该Task要执行的动作</span></span><br><span class="line">    <span class="meta">@TaskAction</span></span><br><span class="line">    <span class="keyword">void</span> sayHello() &#123;</span><br><span class="line">        println <span class="string">"Hello $msg ! age is $&#123;age&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过constructorArgs参数来指定构造函数的参数值</span></span><br><span class="line">task hello1(<span class="string">type:</span> SayHelloTask, <span class="string">constructorArgs:</span> [<span class="number">30</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过type参数指定task的父类，可以在配置代码里修改父类的属性</span></span><br><span class="line">task hello2(<span class="string">type:</span> SayHelloTask, <span class="string">constructorArgs:</span> [<span class="number">18</span>]) &#123;</span><br><span class="line">        <span class="comment">//配置代码里修改 SayHelloTask 里的字段 msg 的值</span></span><br><span class="line">    msg = <span class="string">"hjy"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>执行这2个 task 查看运行结果如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> Task :hello1</span></span><br><span class="line">Hello default name ! age is 30</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Task :hello2</span></span><br><span class="line">Hello hjy ! age is 18</span><br></pre></td></tr></table></figure></div>
<p>看到了，这里就是指定Action的方式。</p>
<p>在Android Studio 中，给Task 指定 group为：group BasePlugin.BUILD_GROUP，才能在Gradle面板中看到，否则看不到的。<br><a href="https://cdn.jsdelivr.net/gh/fanshanhong/note-image/gradle_group.png" data-fancybox="group" data-caption class="fancybox"><img src="https://cdn.jsdelivr.net/gh/fanshanhong/note-image/gradle_group.png" alt title></a></p>
<p>还有，在闭包中指定属性</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">task hello &#123;</span><br><span class="line">    group BasePlugin.BUILD_GROUP</span><br><span class="line">    description <span class="string">"hhhh"</span></span><br><span class="line">    println(<span class="string">"hello"</span>)</span><br><span class="line">    <span class="keyword">def</span> t = project.android.getBuildTypes()</span><br><span class="line">    android.sourceSets.each &#123;</span><br><span class="line">        println it</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>这里的 <code>group BasePlugin.BUILD_GROUP</code> 和 <code>description &quot;hhhh&quot;</code> 都是方法调用。<br>这样是简写的方法调用，gradle 会去找 description(String) 方法，或者是  setDescription(String) 方法，能找到就调用，找不到就报错。<br>如果同时存在description(String) 方法和setDescription(String)，是调用description(String)</p>
<p>也可以通过任务名称来指定。<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello.description = <span class="string">"xxx"</span></span><br></pre></td></tr></table></figure></div></p>
<h1 id="通过任务名来操作任务"><a href="#通过任务名来操作任务" class="headerlink" title="通过任务名来操作任务"></a>通过任务名来操作任务</h1><p>通过任务名，使用Task的API，可以访问Task的相关方法。</p>
<p>要使用任务名来操作任务，必须先声明，因为脚本是顺序执行的。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这种写法明显是错误的。要依赖taskY，必须先声明</span></span><br><span class="line"><span class="comment">//task taskX(dependsOn: 'taskY')  &#123;</span></span><br><span class="line"><span class="comment">//    println 'taskX'</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//task taskY  &#123;</span></span><br><span class="line"><span class="comment">//    println 'taskY'</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">task taskY &#123;</span><br><span class="line">    println <span class="string">'taskY'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task taskX(<span class="string">dependsOn:</span> taskY) &#123;</span><br><span class="line">    println <span class="string">'taskX'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>指定Task的doFirst 和 doLast<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hello.doLast &#123;</span><br><span class="line">    println <span class="string">"1111"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hello.doFirst &#123;</span><br><span class="line">    println <span class="string">"2222"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>指定task的分组和描述</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hello.group = BsePlugin.BUILD_GROUP</span><br><span class="line">hello.description = <span class="string">"这是描述"</span></span><br><span class="line"><span class="comment">//设置依赖的task，只有test1 task执行完后才会执行hello task</span></span><br><span class="line">hello.dependsOn(taskX)</span><br></pre></td></tr></table></figure></div>
<h1 id="Task-Interface"><a href="#Task-Interface" class="headerlink" title="Task Interface"></a>Task Interface</h1><p>Gradle 所说的 Task 是 org.gradle.api.Task 接口，默认实现是 org.gradle.api.DefaultTask 类，其类图大概如下（只节选了比较重要的部分）：</p>
<p><a href="https://cdn.jsdelivr.net/gh/fanshanhong/note-image/task_interface.webp" data-fancybox="group" data-caption class="fancybox"><img src="https://cdn.jsdelivr.net/gh/fanshanhong/note-image/task_interface.webp" alt title></a></p>
<p>为了了解每个接口方法的含义，我们直接用代码来测试验证下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SayHelloTask</span> <span class="keyword">extends</span> <span class="title">DefaultTask</span> &#123;</span></span><br><span class="line">    </span><br><span class="line">    String msg = <span class="string">"default name"</span>;</span><br><span class="line">    <span class="keyword">int</span> age = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TaskAction</span></span><br><span class="line">    <span class="keyword">void</span> sayHello() &#123;</span><br><span class="line">        println <span class="string">"Hello $msg ! Age is $&#123;age&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task test1 &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">"task test1 exec..."</span></span><br><span class="line">&#125;</span><br><span class="line">task test2 &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">"task test2 exec..."</span></span><br><span class="line">&#125;</span><br><span class="line">task test3 &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">"task test3 exec..."</span></span><br><span class="line">&#125;</span><br><span class="line">task hello(<span class="string">type:</span> SayHelloTask, <span class="string">group:</span> <span class="string">"MyGroup"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//对task进行配置，</span></span><br><span class="line">hello.configure &#123;</span><br><span class="line">    println <span class="string">"hello task configure"</span></span><br><span class="line">    msg = <span class="string">"hjy"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取task的名称</span></span><br><span class="line">println <span class="string">"task name is $&#123;hello.getName()&#125;"</span></span><br><span class="line"><span class="comment">//获取task的组名</span></span><br><span class="line">println <span class="string">"task group is $&#123;hello.getGroup()&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置task里的属性值，设置 age = 70</span></span><br><span class="line">hello.setProperty(<span class="string">"age"</span>, <span class="number">70</span>)</span><br><span class="line"><span class="comment">//获取task里的某个属性值</span></span><br><span class="line">println <span class="string">"task msg is $&#123;hello.property('msg')&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置依赖的task，只有test1 task执行完后才会执行hello task</span></span><br><span class="line">hello.dependsOn(test1)</span><br><span class="line"><span class="comment">//设置终结者任务，执行完hello task之后会执行test2 task，通常可以用该方法做一些清理操作</span></span><br><span class="line">hello.finalizedBy(test2)</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果同时执行hello、test3这2个task，会确保test3执行完之后才执行hello这个task，用这个来保证执行顺序</span></span><br><span class="line">hello.setMustRunAfter([test3])</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置满足某个条件后才执行该task</span></span><br><span class="line">hello.setOnlyIf &#123;</span><br><span class="line">    <span class="comment">//只有当 age = 70 时，才会执行task，否则不会执行</span></span><br><span class="line">    <span class="keyword">return</span> hello.property(<span class="string">"age"</span>) == <span class="number">70</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>我们执行任务gradle hello test3，结果如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> Configure project :</span></span><br><span class="line">hello task configure</span><br><span class="line">task name is hello</span><br><span class="line">task group is MyGroup</span><br><span class="line">task msg is hjy</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Task :test3</span></span><br><span class="line">task test3 exec...</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Task :test1</span></span><br><span class="line">task test1 exec...</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Task :hello</span></span><br><span class="line">Hello hjy ! Age is 70</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Task :test2</span></span><br><span class="line">task test2 exec...</span><br></pre></td></tr></table></figure></div>
<h1 id="TaskContainer接口解析"><a href="#TaskContainer接口解析" class="headerlink" title="TaskContainer接口解析"></a>TaskContainer接口解析</h1><p>TaskContianer 是用来管理所有的 Task 实例集合的，可以通过 Project.getTasks() 来获取 TaskContainer 实例。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">org.gradle.api.tasks.TaskContainer接口：</span><br><span class="line"><span class="comment">//查找task</span></span><br><span class="line">findByPath(<span class="string">path:</span> String): Task</span><br><span class="line">getByPath(<span class="string">path:</span> String): Task</span><br><span class="line">getByName(<span class="string">name:</span> String): Task</span><br><span class="line">withType(<span class="string">type:</span> Class): TaskCollection</span><br><span class="line">matching(<span class="string">condition:</span> Closure): TaskCollection</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建task</span></span><br><span class="line">create(<span class="string">name:</span> String): Task</span><br><span class="line">create(<span class="string">name:</span> String, <span class="string">configure:</span> Closure): Task </span><br><span class="line">create(<span class="string">name:</span> String, <span class="string">type:</span> Class): Task</span><br><span class="line">create(<span class="string">options:</span> Map&lt;String, ?&gt;): Task</span><br><span class="line">create(<span class="string">options:</span> Map&lt;String, ?&gt;, configure: Closure): Task</span><br><span class="line"></span><br><span class="line"><span class="comment">//当task被加入到TaskContainer时的监听</span></span><br><span class="line">whenTaskAdded(<span class="string">action:</span> Closure)</span><br></pre></td></tr></table></figure></div>
<p>我们先来看看创建 task 的方法：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当有task创建时</span></span><br><span class="line">getTasks().whenTaskAdded &#123; Task task -&gt;</span><br><span class="line">    println <span class="string">"The task $&#123;task.getName()&#125; is added to the TaskContainer"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//采用create(name: String)创建</span></span><br><span class="line">getTasks().create(<span class="string">"task1"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//采用create(options: Map&lt;String, ?&gt;)创建</span></span><br><span class="line">getTasks().create([<span class="string">name:</span> <span class="string">"task2"</span>, <span class="string">group:</span> <span class="string">"MyGroup"</span>, <span class="string">description:</span> <span class="string">"这是task2描述"</span>, <span class="string">dependsOn:</span> [<span class="string">"task1"</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment">//采用create(options: Map&lt;String, ?&gt;, configure: Closure)创建</span></span><br><span class="line">getTasks().create(<span class="string">"task3"</span>, &#123;</span><br><span class="line">    group <span class="string">"MyGroup"</span></span><br><span class="line">    setDependsOn([<span class="string">"task1"</span>, <span class="string">"task2"</span>])</span><br><span class="line">    setDescription <span class="string">"这是task3描述"</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
<p>执行命令gradle -q tasks –all，查看是否创建成功，结果如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MyGroup tasks</span><br><span class="line">-------------</span><br><span class="line">task2 - 这是task2描述</span><br><span class="line">task3 - 这是task3描述</span><br><span class="line"></span><br><span class="line">Other tasks</span><br><span class="line">-----------</span><br><span class="line">task1</span><br></pre></td></tr></table></figure></div>
<p>我们再来试试查找 task 的方法：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过名字查找指定的task</span></span><br><span class="line"><span class="keyword">def</span> task3 = getTasks().findByName(<span class="string">"task3"</span>)</span><br><span class="line">println <span class="string">"findByName() return task is "</span> + task3</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> taskList = getTasks().withType(DefaultTask)</span><br><span class="line"><span class="keyword">def</span> count = <span class="number">0</span></span><br><span class="line"><span class="comment">//遍历所有的task，打印出其名字</span></span><br><span class="line">taskList.all &#123; Task t -&gt;</span><br><span class="line">    println <span class="string">"$&#123;count++&#125; task name is $&#123;t.name&#125;"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h1 id="Task增量构建"><a href="#Task增量构建" class="headerlink" title="Task增量构建"></a>Task增量构建</h1><p>gradle 会比较 task 的 inputs 和 outputs 来决定 task 是否是最新的，如果 inputs 和 outputs 没有变化，则认为 task 是最新的，task 就会跳过不执行，叫做 up-to-date 检查的功能</p>
<p>通常，一个 task 会有一些输入(inputs)和一些输出(outputs)，task 的输入会影响其输出结果，以官网中的一张图为例：</p>
<p><a href="https://cdn.jsdelivr.net/gh/fanshanhong/note-image/task_up_to_date.webp" data-fancybox="group" data-caption class="fancybox"><img src="https://cdn.jsdelivr.net/gh/fanshanhong/note-image/task_up_to_date.webp" alt title></a></p>
<p>图中表示一个 java 编译的 task，它的输入有2种，一是 JDK 版本号，一是源文件，它的输出结果为 class 文件，只要 JDK 版本号与源文件有任何变动，最终编译出的 class 文件肯定是不同的。当我们执行过一次编译任务后，再次运行该 task ，如果发现它的输入没有任何改变，那么它编译后的结果肯定也是不会变化的，可以直接从缓存里获取输出，这样 Gradle 会标识该 task 为 UP-TO-DATE，进而跳过该 task 的执行。</p>
<h2 id="TaskInputs、TaskOutputs"><a href="#TaskInputs、TaskOutputs" class="headerlink" title="TaskInputs、TaskOutputs"></a>TaskInputs、TaskOutputs</h2><p>那么怎么实现一个增量构建呢？一个增量构建必须至少指定一个输入、一个输出，从前面 Task 的类图中可以看到，Task.getInputs() 对象类型为 TaskInputs，Task.getOutputs() 对象类型为 TaskOuputs，从中也可以看到inputs、outputs都支持哪些数据类型。同样以一个简单例子来说明：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">task test1 &#123;</span><br><span class="line">    <span class="comment">//设置inputs</span></span><br><span class="line">    inputs.property(<span class="string">"name"</span>, <span class="string">"hjy"</span>)</span><br><span class="line">    inputs.property(<span class="string">"age"</span>, <span class="number">20</span>)</span><br><span class="line">    <span class="comment">//设置outputs</span></span><br><span class="line">    outputs.file(<span class="string">"$buildDir/test.txt"</span>)</span><br><span class="line"></span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">"exec task task1"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task test2 &#123;</span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">"exec task task2"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>连续2次运行task，执行命令gradle test1 test2，结果如下：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//第一次的运行结果</span><br><span class="line">&gt; Task :test1</span><br><span class="line">exec task task1</span><br><span class="line"></span><br><span class="line">&gt; Task :test2</span><br><span class="line">exec task task2</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL in 0s</span><br><span class="line">2 actionable tasks: 2 executed</span><br><span class="line"></span><br><span class="line">//第二次的运行结果</span><br><span class="line">&gt; Task :test2</span><br><span class="line">exec task task2</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL in 0s</span><br><span class="line">2 actionable tasks: 1 executed, 1 up-to-date</span><br></pre></td></tr></table></figure></div></p>
<p>从结果中可以看到，第2次运行时，test1 task 并没有运行，而是被标记为 up-to-date，而 test2 task 则每次都会运行，这就是典型的增量构建。</p>
<h2 id="taskInputs、taskOutputs注解"><a href="#taskInputs、taskOutputs注解" class="headerlink" title="taskInputs、taskOutputs注解"></a>taskInputs、taskOutputs注解</h2><p>当你自定义 task class 时，可以通过注解来实现增量构建，这是一种更加灵活方便的方式。我们常用的注解包括：</p>
<table>
<thead>
<tr>
<th>注解名</th>
<th>属性类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Input</td>
<td>任意Serializable类型</td>
<td>一个简单的输入值</td>
</tr>
<tr>
<td>@InputFile</td>
<td>File</td>
<td>一个输入文件，不是目录</td>
</tr>
<tr>
<td>@InputDirectory</td>
<td>File</td>
<td>一个输入目录，不是文件</td>
</tr>
<tr>
<td>@InputFiles</td>
<td>Iterable<file></file></td>
<td>File列表，包含文件和目录</td>
</tr>
<tr>
<td>@OutputFile</td>
<td>File</td>
<td>一个输出文件，不是目录</td>
</tr>
<tr>
<td>@OutputDirectory</td>
<td>File</td>
<td>一个输出目录，不是文件</td>
</tr>
<tr>
<td>@OutputFiles</td>
<td>Map&lt;String, File&gt;或Iterable<file></file></td>
<td>输出文件列表</td>
</tr>
<tr>
<td>@OutputDirectories</td>
<td>Map&lt;String, File&gt;或Iterable<file></file></td>
<td>输出目录列表</td>
</tr>
</tbody>
</table>
<p>我们通过自定义一个 task class 来演示一下用法：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SayHelloTask</span> <span class="keyword">extends</span> <span class="title">DefaultTask</span> &#123;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//定义输入</span></span><br><span class="line">    <span class="meta">@Input</span></span><br><span class="line">    String username;</span><br><span class="line">    <span class="meta">@Input</span></span><br><span class="line">    <span class="keyword">int</span> age</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义输出</span></span><br><span class="line">    <span class="meta">@OutputDirectory</span></span><br><span class="line">    File destDir;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TaskAction</span></span><br><span class="line">    <span class="keyword">void</span> sayHello() &#123;</span><br><span class="line">        println <span class="string">"Hello $username ! age is $age"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task test(<span class="string">type:</span> SayHelloTask) &#123;</span><br><span class="line">    age = <span class="number">18</span></span><br><span class="line">    username = <span class="string">"hjy"</span></span><br><span class="line">    destDir = file(<span class="string">"$buildDir/test"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>执行该 task 之后，会自动生成一个 $buildDir/test 文件目录，当你再次运行时就实施增量构建。但是当你修改 age、username 的值，或者删除磁盘上 $buildDir/test 目录，再次运行该 task ，该 task 就会重新运行。</p>
<h1 id="任务排序"><a href="#任务排序" class="headerlink" title="任务排序"></a>任务排序</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// taskB 应该在taskA之后执行，但是不能保证</span></span><br><span class="line">taskB.showRunAfter(taskA)</span><br><span class="line"><span class="comment">// taskB必须在taskA之后执行，强制</span></span><br><span class="line">taskB.mustRunAfter(taskA)</span><br></pre></td></tr></table></figure></div>
<h1 id="任务启用和禁用"><a href="#任务启用和禁用" class="headerlink" title="任务启用和禁用"></a>任务启用和禁用</h1><p>task 中有个 enabled 属性，用于启用和禁用任务。默认是true，表示启用。如果设置为false，则禁止任务执行，该任务被跳过.</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">task enableTask &#123;</span><br><span class="line">    doFirst &#123;</span><br><span class="line">        println <span class="string">"11122"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enableTask.enabled = <span class="literal">false</span></span><br></pre></td></tr></table></figure></div>
<h1 id="任务的onlyIf"><a href="#任务的onlyIf" class="headerlink" title="任务的onlyIf"></a>任务的onlyIf</h1><p>断言就是一个条件表达式。Task 有个onlyIf 方法，接收一个闭包作为参数。如果该闭包返回true，则任务执行；否则跳过。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置task里的属性值，设置 age = 70</span></span><br><span class="line">hello.setProperty(<span class="string">"age"</span>, <span class="number">70</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置满足某个条件后才执行该task</span></span><br><span class="line">hello.setOnlyIf &#123;</span><br><span class="line">    <span class="comment">//只有当 age = 70 时，才会执行task，否则不会执行</span></span><br><span class="line">    <span class="keyword">return</span> hello.property(<span class="string">"age"</span>) == <span class="number">70</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Fan shanhong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2021/01/23/Gradle/3.Task/">http://yoursite.com/2021/01/23/Gradle/3.Task/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Task/">Task    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2021/01/23/Gradle/4.Project/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Previous Post</div><div class="prev_info"><span>Project</span></div></a></div><div class="next-post pull_right"><a href="/2020/12/17/Metadata说明/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span></span></div></a></div></nav></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Fan shanhong</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script></body></html>