<!DOCTYPE html><html data-theme="light"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>11.Android Gradle插件 | Fan Blog</title><meta name="description" content="​"><meta name="keywords" content="Gradle"><meta name="author" content="Fan shanhong"><meta name="copyright" content="Fan shanhong"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="11.Android Gradle插件"><meta name="twitter:description" content="​"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="11.Android Gradle插件"><meta property="og:url" content="http://yoursite.com/2021/01/28/Gradle/11.Android Gradle插件/"><meta property="og:site_name" content="Fan Blog"><meta property="og:description" content="​"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2021/01/28/Gradle/11.Android Gradle插件/"><link rel="prev" title="10.Java Gradle插件" href="http://yoursite.com/2021/01/28/Gradle/10.Java Gradle插件/"><link rel="next" title="9.Gradle插件" href="http://yoursite.com/2021/01/28/Gradle/9.Gradle插件/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Fan Blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">157</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">31</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">26</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">Catalog</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Android-Gradle-分类"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">Android Gradle 分类</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Android-插件属性介绍"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">Android 插件属性介绍</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#android"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">android{}</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#compileSdkVersion"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">compileSdkVersion</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#buildToolVersion"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">buildToolVersion</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#defaultConfig"><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text">defaultConfig</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#applicationId"><span class="toc_mobile_items-number">2.4.1.</span> <span class="toc_mobile_items-text">applicationId</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#minSdkVersion"><span class="toc_mobile_items-number">2.4.2.</span> <span class="toc_mobile_items-text">minSdkVersion</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#targetSdkVersion"><span class="toc_mobile_items-number">2.4.3.</span> <span class="toc_mobile_items-text">targetSdkVersion</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#versionCode和versionName"><span class="toc_mobile_items-number">2.4.4.</span> <span class="toc_mobile_items-text">versionCode和versionName</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#signingConfig"><span class="toc_mobile_items-number">2.4.5.</span> <span class="toc_mobile_items-text">signingConfig</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#配置签名信息"><span class="toc_mobile_items-number">2.5.</span> <span class="toc_mobile_items-text">配置签名信息</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#buildType"><span class="toc_mobile_items-number">2.6.</span> <span class="toc_mobile_items-text">buildType</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#BuildType-java提供的属性"><span class="toc_mobile_items-number">2.6.1.</span> <span class="toc_mobile_items-text">BuildType.java提供的属性</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#javaCompileOptions"><span class="toc_mobile_items-number">2.6.1.1.</span> <span class="toc_mobile_items-text">javaCompileOptions</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#shrinkResources"><span class="toc_mobile_items-number">2.6.1.2.</span> <span class="toc_mobile_items-text">shrinkResources</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#父类DefaultBuildType-java提供的属性"><span class="toc_mobile_items-number">2.6.2.</span> <span class="toc_mobile_items-text">父类DefaultBuildType.java提供的属性</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#mDebuggable"><span class="toc_mobile_items-number">2.6.2.1.</span> <span class="toc_mobile_items-text">mDebuggable</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#mJniDebuggable"><span class="toc_mobile_items-number">2.6.2.2.</span> <span class="toc_mobile_items-text">mJniDebuggable</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#mMinifyEnabled"><span class="toc_mobile_items-number">2.6.2.3.</span> <span class="toc_mobile_items-text">mMinifyEnabled</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#mSigningConfig"><span class="toc_mobile_items-number">2.6.2.4.</span> <span class="toc_mobile_items-text">mSigningConfig</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#mZipAlignEnabled"><span class="toc_mobile_items-number">2.6.2.5.</span> <span class="toc_mobile_items-text">mZipAlignEnabled</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#在-父类BaseConfigImpl中，还有一些属性"><span class="toc_mobile_items-number">2.6.3.</span> <span class="toc_mobile_items-text">在 父类BaseConfigImpl中，还有一些属性</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#mProguardFiles"><span class="toc_mobile_items-number">2.6.3.1.</span> <span class="toc_mobile_items-text">mProguardFiles</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#mManifestPlaceholders"><span class="toc_mobile_items-number">2.6.3.2.</span> <span class="toc_mobile_items-text">mManifestPlaceholders</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#mMultiDexEnabled"><span class="toc_mobile_items-number">2.6.3.3.</span> <span class="toc_mobile_items-text">mMultiDexEnabled</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#使用混淆"><span class="toc_mobile_items-number">2.7.</span> <span class="toc_mobile_items-text">使用混淆</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#共享库"><span class="toc_mobile_items-number">2.8.</span> <span class="toc_mobile_items-text">共享库</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#批量修改APK文件名"><span class="toc_mobile_items-number">2.9.</span> <span class="toc_mobile_items-text">批量修改APK文件名</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#修改-build-目录"><span class="toc_mobile_items-number">2.10.</span> <span class="toc_mobile_items-text">修改 build 目录</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#版本信息统一管理"><span class="toc_mobile_items-number">2.11.</span> <span class="toc_mobile_items-text">版本信息统一管理</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#动态配置-AndroidManifest-文件"><span class="toc_mobile_items-number">2.12.</span> <span class="toc_mobile_items-text">动态配置 AndroidManifest 文件</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#自定义BuildConfig"><span class="toc_mobile_items-number">2.13.</span> <span class="toc_mobile_items-text">自定义BuildConfig</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Java-编译选项"><span class="toc_mobile_items-number">2.14.</span> <span class="toc_mobile_items-text">Java 编译选项</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#DEX选项配置"><span class="toc_mobile_items-number">2.15.</span> <span class="toc_mobile_items-text">DEX选项配置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#自动清理未使用的资源"><span class="toc_mobile_items-number">2.16.</span> <span class="toc_mobile_items-text">自动清理未使用的资源</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#突破65535方法限制"><span class="toc_mobile_items-number">2.17.</span> <span class="toc_mobile_items-text">突破65535方法限制</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Android-Gradle-任务"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">Android Gradle 任务</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#守护进程"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">守护进程</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Android-Gradle-分类"><span class="toc-number">1.</span> <span class="toc-text">Android Gradle 分类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Android-插件属性介绍"><span class="toc-number">2.</span> <span class="toc-text">Android 插件属性介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#android"><span class="toc-number">2.1.</span> <span class="toc-text">android{}</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#compileSdkVersion"><span class="toc-number">2.2.</span> <span class="toc-text">compileSdkVersion</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#buildToolVersion"><span class="toc-number">2.3.</span> <span class="toc-text">buildToolVersion</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#defaultConfig"><span class="toc-number">2.4.</span> <span class="toc-text">defaultConfig</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#applicationId"><span class="toc-number">2.4.1.</span> <span class="toc-text">applicationId</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#minSdkVersion"><span class="toc-number">2.4.2.</span> <span class="toc-text">minSdkVersion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#targetSdkVersion"><span class="toc-number">2.4.3.</span> <span class="toc-text">targetSdkVersion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#versionCode和versionName"><span class="toc-number">2.4.4.</span> <span class="toc-text">versionCode和versionName</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#signingConfig"><span class="toc-number">2.4.5.</span> <span class="toc-text">signingConfig</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置签名信息"><span class="toc-number">2.5.</span> <span class="toc-text">配置签名信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#buildType"><span class="toc-number">2.6.</span> <span class="toc-text">buildType</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BuildType-java提供的属性"><span class="toc-number">2.6.1.</span> <span class="toc-text">BuildType.java提供的属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#javaCompileOptions"><span class="toc-number">2.6.1.1.</span> <span class="toc-text">javaCompileOptions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shrinkResources"><span class="toc-number">2.6.1.2.</span> <span class="toc-text">shrinkResources</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#父类DefaultBuildType-java提供的属性"><span class="toc-number">2.6.2.</span> <span class="toc-text">父类DefaultBuildType.java提供的属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mDebuggable"><span class="toc-number">2.6.2.1.</span> <span class="toc-text">mDebuggable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mJniDebuggable"><span class="toc-number">2.6.2.2.</span> <span class="toc-text">mJniDebuggable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mMinifyEnabled"><span class="toc-number">2.6.2.3.</span> <span class="toc-text">mMinifyEnabled</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mSigningConfig"><span class="toc-number">2.6.2.4.</span> <span class="toc-text">mSigningConfig</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mZipAlignEnabled"><span class="toc-number">2.6.2.5.</span> <span class="toc-text">mZipAlignEnabled</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在-父类BaseConfigImpl中，还有一些属性"><span class="toc-number">2.6.3.</span> <span class="toc-text">在 父类BaseConfigImpl中，还有一些属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mProguardFiles"><span class="toc-number">2.6.3.1.</span> <span class="toc-text">mProguardFiles</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mManifestPlaceholders"><span class="toc-number">2.6.3.2.</span> <span class="toc-text">mManifestPlaceholders</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mMultiDexEnabled"><span class="toc-number">2.6.3.3.</span> <span class="toc-text">mMultiDexEnabled</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用混淆"><span class="toc-number">2.7.</span> <span class="toc-text">使用混淆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#共享库"><span class="toc-number">2.8.</span> <span class="toc-text">共享库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#批量修改APK文件名"><span class="toc-number">2.9.</span> <span class="toc-text">批量修改APK文件名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修改-build-目录"><span class="toc-number">2.10.</span> <span class="toc-text">修改 build 目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#版本信息统一管理"><span class="toc-number">2.11.</span> <span class="toc-text">版本信息统一管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态配置-AndroidManifest-文件"><span class="toc-number">2.12.</span> <span class="toc-text">动态配置 AndroidManifest 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义BuildConfig"><span class="toc-number">2.13.</span> <span class="toc-text">自定义BuildConfig</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java-编译选项"><span class="toc-number">2.14.</span> <span class="toc-text">Java 编译选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DEX选项配置"><span class="toc-number">2.15.</span> <span class="toc-text">DEX选项配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自动清理未使用的资源"><span class="toc-number">2.16.</span> <span class="toc-text">自动清理未使用的资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#突破65535方法限制"><span class="toc-number">2.17.</span> <span class="toc-text">突破65535方法限制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Android-Gradle-任务"><span class="toc-number">3.</span> <span class="toc-text">Android Gradle 任务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#守护进程"><span class="toc-number">4.</span> <span class="toc-text">守护进程</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">11.Android Gradle插件</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> Created 2021-01-28<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> Updated 2021-02-07</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Gradle/">Gradle</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>Post View:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><!-- TOC -->
<ul>
<li><a href="#android-gradle-分类">Android Gradle 分类</a></li>
<li><a href="#android-插件属性介绍">Android 插件属性介绍</a><ul>
<li><a href="#android">android{}</a></li>
<li><a href="#compilesdkversion">compileSdkVersion</a></li>
<li><a href="#buildtoolversion">buildToolVersion</a></li>
<li><a href="#defaultconfig">defaultConfig</a><ul>
<li><a href="#applicationid">applicationId</a></li>
<li><a href="#minsdkversion">minSdkVersion</a></li>
<li><a href="#targetsdkversion">targetSdkVersion</a></li>
<li><a href="#versioncode和versionname">versionCode和versionName</a></li>
<li><a href="#signingconfig">signingConfig</a></li>
</ul>
</li>
<li><a href="#配置签名信息">配置签名信息</a></li>
<li><a href="#buildtype">buildType</a><ul>
<li><a href="#buildtypejava提供的属性">BuildType.java提供的属性</a><ul>
<li><a href="#javacompileoptions">javaCompileOptions</a></li>
<li><a href="#shrinkresources">shrinkResources</a></li>
</ul>
</li>
<li><a href="#父类defaultbuildtypejava提供的属性">父类DefaultBuildType.java提供的属性</a><ul>
<li><a href="#mdebuggable">mDebuggable</a></li>
<li><a href="#mjnidebuggable">mJniDebuggable</a></li>
<li><a href="#mminifyenabled">mMinifyEnabled</a></li>
<li><a href="#msigningconfig">mSigningConfig</a></li>
<li><a href="#mzipalignenabled">mZipAlignEnabled</a></li>
</ul>
</li>
<li><a href="#在-父类baseconfigimpl中还有一些属性">在 父类BaseConfigImpl中，还有一些属性</a><ul>
<li><a href="#mproguardfiles">mProguardFiles</a></li>
<li><a href="#mmanifestplaceholders">mManifestPlaceholders</a></li>
<li><a href="#mmultidexenabled">mMultiDexEnabled</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#使用混淆">使用混淆</a></li>
<li><a href="#共享库">共享库</a></li>
<li><a href="#批量修改apk文件名">批量修改APK文件名</a></li>
<li><a href="#修改-build-目录">修改 build 目录</a></li>
<li><a href="#版本信息统一管理">版本信息统一管理</a></li>
<li><a href="#动态配置-androidmanifest-文件">动态配置 AndroidManifest 文件</a></li>
<li><a href="#自定义buildconfig">自定义BuildConfig</a></li>
<li><a href="#java-编译选项">Java 编译选项</a></li>
<li><a href="#dex选项配置">DEX选项配置</a></li>
<li><a href="#自动清理未使用的资源">自动清理未使用的资源</a></li>
<li><a href="#突破65535方法限制">突破65535方法限制</a></li>
</ul>
</li>
<li><a href="#android-gradle-任务">Android Gradle 任务</a></li>
<li><a href="#守护进程">守护进程</a></li>
</ul>
<!-- /TOC -->
<h1 id="Android-Gradle-分类"><a href="#Android-Gradle-分类" class="headerlink" title="Android Gradle 分类"></a>Android Gradle 分类</h1><p>Android 有三类工程:</p>
<ul>
<li>APP应用工程，可以生成一个可运行的APK</li>
<li>Library 库工程，可以生成aar包，给其他工程使用</li>
<li>Test 测试工程，用于对APP或者Library进行单元测试</li>
</ul>
<p>针对Android的三类工程，Android Gradle 提供了三个插件</p>
<ul>
<li>APP插件，id：com.android.application</li>
<li>Library插件，id：com.android.library</li>
<li>Test插件，id：com.android.test</li>
</ul>
<p>这样我们就能明白，平常在我们app工程下的build.gradle 第一行总是：<br><code>apply plugin: &#39;com.android.application&#39;</code></p>
<p>在一个库工程下的build.gradle文件第一行总是：<br><code>apply plugin: &#39;com.android.library&#39;</code></p>
<p>按照我们之前讲的，要使用一个第三方插件，步骤是：</p>
<ol>
<li>dependencies</li>
<li>repositories</li>
<li>apply</li>
</ol>
<p>现在我们知道apply了，那在哪里配置  dependencies  和 repositories</p>
<p>在根目录下的build.gradle中<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath <span class="string">'com.android.tools.build:gradle:3.5.2'</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// <span class="doctag">NOTE:</span> Do not place your application dependencies here; they belong</span></span><br><span class="line">        <span class="comment">// in the individual module build.gradle files</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>关于 buildscript 我们知道，</p>
<ol>
<li>buildscript 配置的 是gradle脚本自身需要使用的资源。</li>
<li>gradle在执行脚本时，会优先执行buildscript代码块中的内容，然后才会执行剩余的build脚本。</li>
</ol>
<p>这里我们配置在 buildscript 的就是 Android Gradle 脚本自身执行需要用的的资源。</p>
<p>dependencies 指定我们依赖的是哪个第三方库，然后repositories指定要去哪个仓库下载。</p>
<p>buildscript 写在根工程之后，所有的子工程就不用重复配置了。要不的话，需要给每个子工程的build.gradle都配置这个。</p>
<h1 id="Android-插件属性介绍"><a href="#Android-插件属性介绍" class="headerlink" title="Android 插件属性介绍"></a>Android 插件属性介绍</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">28</span></span><br><span class="line">    buildToolsVersion <span class="string">"28.0.3"</span></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">"cc.ewell.mobile.drugapp"</span> <span class="comment">// 这个是配置属性,可以用=,也可以不加=.  其实是调用了setApplicationId 方法</span></span><br><span class="line">        minSdkVersion <span class="number">22</span> <span class="comment">// 这个是方法调用,调用了minSdkVersion</span></span><br><span class="line">        targetSdkVersion <span class="number">28</span></span><br><span class="line">        versionCode <span class="number">7</span></span><br><span class="line">        versionName <span class="string">"1.4.4"</span></span><br><span class="line">        flavorDimensions <span class="string">"versionCode"</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="android"><a href="#android" class="headerlink" title="android{}"></a>android{}</h2><p>android{} 是Android Gradle插件提供的一个Project的扩展。具体看：<a href="https://github.com/fanshanhong/note/blob/master/Gradle/5.%20Extension%E8%AF%A6%E8%A7%A3.md" target="_blank" rel="noopener">https://github.com/fanshanhong/note/blob/master/Gradle/5.%20Extension%E8%AF%A6%E8%A7%A3.md</a></p>
<p><strong>Android Gradle的工程配置，都是在android{} 中，这是唯一的入口。通过它，可以对Android Gradle 进行自定义配置，具体实现是  com.android.build.gradle.AppExtension，是Project的一个扩展。</strong></p>
<p>这个一定要明确。android对象就是 AppExtension， 它的父类是 BaseExtension。这两个类为他们提供了很多的配置方法。</p>
<p>创建原型如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extension = project.extensions.create(<span class="string">'android'</span>, getExtensionClass(),(ProjectInternal)project, instantiator, androidBuilder, sdkHandler, buildTypeContainer, productFlavorContainer, signingConfigContainer, extraModeInfo, isLibrary())</span><br></pre></td></tr></table></figure></div>
<p>显然，是用了创建Extension的这个方法：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建Extension</span></span><br><span class="line">&lt;T&gt; T create​(String name, Class&lt;T&gt; type, Object... constructionArguments)</span><br></pre></td></tr></table></figure></div></p>
<p>指定了扩展的名字就是 android， 然后类型是 getExtensionClass()的返回值。</p>
<p>在com.android.application插件中， getExtensionClass()返回值就是  com.android.build.gradle.AppExtension 类型。因此，我们在android 这个扩展中配置的内容，其实就是  AppExtension 的属性。</p>
<h2 id="compileSdkVersion"><a href="#compileSdkVersion" class="headerlink" title="compileSdkVersion"></a>compileSdkVersion</h2><p>配置我们编译Android工程的SDK版本。 这里是在调用  compileSdkVersion 方法。我们知道在groovy中，方法调用括号可以省略。</p>
<p>原型是:<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@see</span> #getCompileSdkVersion() */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> compileSdkVersion(String version) &#123;</span><br><span class="line">    checkWritability();</span><br><span class="line">    <span class="keyword">this</span>.target = version;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@see</span> #getCompileSdkVersion() */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> compileSdkVersion(<span class="keyword">int</span> apiLevel) &#123;</span><br><span class="line">    compileSdkVersion(<span class="string">"android-"</span> + apiLevel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>传入int或者String都可以。如果用String的话这样写</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">   compileSdkVersion <span class="string">'android-28'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>此外，还有set方法。set方法内部也是调用了 上面的 compileSdkVersion 方法。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> setCompileSdkVersion(<span class="keyword">int</span> apiLevel) &#123;</span><br><span class="line">    compileSdkVersion(apiLevel);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> setCompileSdkVersion(String target) &#123;</span><br><span class="line">    compileSdkVersion(target);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>如果使用set方法的话：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">   android.compileSdkVersion = 28 // 这样就调用set方法，像Dart一样。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="buildToolVersion"><a href="#buildToolVersion" class="headerlink" title="buildToolVersion"></a>buildToolVersion</h2><p>buildToolsVersion 设定使用的Android构建工具的版本。我们可以在Android SDK的目录中看到，它是一个工具包，包括appt， dex等。</p>
<p>原型<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildToolsVersion</span><span class="params">(String version)</span> </span>&#123;</span><br><span class="line">    checkWritability();</span><br><span class="line">    <span class="comment">//The underlying Revision class has the maven artifact semantic,</span></span><br><span class="line">    <span class="comment">// so 20 is not the same as 20.0. For the build tools revision this</span></span><br><span class="line">    <span class="comment">// is not the desired behavior, so normalize e.g. to 20.0.0.</span></span><br><span class="line">    buildToolsRevision = Revision.parseRevision(version, Revision.Precision.MICRO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>有set方法和get方法<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** &#123;<span class="doctag">@inheritDoc</span>&#125; */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getBuildToolsVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> buildToolsRevision.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBuildToolsVersion</span><span class="params">(String version)</span> </span>&#123;</span><br><span class="line">    buildToolsVersion(version);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>因此我们可以通过 buildToolsVersion 方法给它赋值，也可以通过setBuildToolsVersion()方法富智，也可以通过android.buildToolsVersion这个属性来读取它的值。</p>
<h2 id="defaultConfig"><a href="#defaultConfig" class="headerlink" title="defaultConfig"></a>defaultConfig</h2><p>defaultConfig 是一些默认配置。它是一个 ProductFlavor。 ProductFlavor 允许我们根据不同的情况同时生成多个不同的APK包。<br>如果一个ProductFlavor没有被特殊定义的话，默认就会使用defaultConfig中配置的内容</p>
<p>我们看下代码中，defaultConfig的原型是：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Specifies defaults for variant properties that the Android plugin applies to all build</span></span><br><span class="line"><span class="comment"> * variants.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;You can override any &lt;code&gt;defaultConfig&lt;/code&gt; property when &lt;a</span></span><br><span class="line"><span class="comment"> * href="https://developer.android.com/studio/build/build-variants.html#product-flavors"&gt;</span></span><br><span class="line"><span class="comment"> * configuring product flavors&lt;/a&gt;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;For more information about the properties you can configure in this block, see &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * ProductFlavor&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">defaultConfig</span><span class="params">(Action&lt;DefaultConfig&gt; action)</span> </span>&#123;</span><br><span class="line">    checkWritability();</span><br><span class="line">    action.execute(defaultConfig);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>我们在build.gradle 中写 defaultConfig，其实是在调用上面的这个方法。</p>
<p>这同我们在 Extension 中讲的，创建嵌套Extension是一致的。这个defaultConfig就相当于android Extension的嵌套Extension。因此，要在android 这个对象（即：AppExtension）中，添加defaultConfig(…)这个方法。</p>
<p>实际上，defaultConfig(…)这个方法是BaseExtension类中的。</p>
<p><code>AppExtension extends BaseExtension</code> 。这样就理解了。</p>
<p>查看代码，我们看到<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** DSL object for the defaultConfig object. */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"WeakerAccess"</span>, <span class="string">"unused"</span>&#125;) <span class="comment">// Exposed in the DSL.</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultConfig</span> <span class="keyword">extends</span> <span class="title">BaseFlavor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DefaultConfig</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @NonNull String name,</span></span></span><br><span class="line"><span class="function"><span class="params">            @NonNull Project project,</span></span></span><br><span class="line"><span class="function"><span class="params">            @NonNull ObjectFactory objectFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">            @NonNull DeprecationReporter deprecationReporter,</span></span></span><br><span class="line"><span class="function"><span class="params">            @NonNull Logger logger)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name, project, objectFactory, deprecationReporter, logger);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Base DSL object used to configure product flavors. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseFlavor</span> <span class="keyword">extends</span> <span class="title">DefaultProductFlavor</span> <span class="keyword">implements</span> <span class="title">CoreProductFlavor</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultProductFlavor</span> <span class="keyword">extends</span> <span class="title">BaseConfigImpl</span> <span class="keyword">implements</span> <span class="title">ProductFlavor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>因此，上面说，defaultConfig 是一个 ProductFlavor</p>
<p>我们经常看到的配置，都是存在于DefaultProductFlavor中和BaseFlavor中。</p>
<p>下面是我们在 defaultConfig中经常配置的一些属性：</p>
<h3 id="applicationId"><a href="#applicationId" class="headerlink" title="applicationId"></a>applicationId</h3><p>applicationId，指定包名。它是 DefaultProductFlavor的一个属性：mApplicationId，用于指定生成的App的包。这里配置 applicationId，实际是调用DefaultProductFlavor的方法：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ProductFlavor <span class="title">setApplicationId</span><span class="params">(String applicationId)</span> </span>&#123;</span><br><span class="line">    mApplicationId = applicationId;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<h3 id="minSdkVersion"><a href="#minSdkVersion" class="headerlink" title="minSdkVersion"></a>minSdkVersion</h3><p>minSdkVersion，表示最低支持的android系统版本。如果要安装的系统低于这个版本，就会提示无法安装。它实际是调用BaseFlavor的方法：<code>minSdkVersion(int minSdkVersion)</code>。我们前面说过，当set方法和 minSdkVersion 都存在的时候，是调用 minSdkVersion 方法的。如果minSdkVersion 方法没有，只有set方法，那就是调用set方法的。<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMinSdkVersion</span><span class="params">(<span class="keyword">int</span> minSdkVersion)</span> </span>&#123;</span><br><span class="line">    setMinSdkVersion(<span class="keyword">new</span> DefaultApiVersion(minSdkVersion));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Sets minimum SDK version.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;See &lt;a href="http://developer.android.com/guide/topics/manifest/uses-sdk-element.html"&gt;</span></span><br><span class="line"><span class="comment"> * uses-sdk element documentation&lt;/a&gt;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">minSdkVersion</span><span class="params">(<span class="keyword">int</span> minSdkVersion)</span> </span>&#123;</span><br><span class="line">    setMinSdkVersion(minSdkVersion);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<h3 id="targetSdkVersion"><a href="#targetSdkVersion" class="headerlink" title="targetSdkVersion"></a>targetSdkVersion</h3><p>targetSdkVersion，表示我们是基于哪个Android版本开发的。实际是调用BaseFlavor的targetSdkVersion方法<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">public</span> com.android.builder.model.<span class="function">ProductFlavor <span class="title">setTargetSdkVersion</span><span class="params">(<span class="keyword">int</span> targetSdkVersion)</span> </span>&#123;</span><br><span class="line">    setTargetSdkVersion(<span class="keyword">new</span> DefaultApiVersion(targetSdkVersion));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Sets the target SDK version to the given value.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;See &lt;a href="http://developer.android.com/guide/topics/manifest/uses-sdk-element.html"&gt;</span></span><br><span class="line"><span class="comment"> * uses-sdk element documentation&lt;/a&gt;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">targetSdkVersion</span><span class="params">(<span class="keyword">int</span> targetSdkVersion)</span> </span>&#123;</span><br><span class="line">    setTargetSdkVersion(targetSdkVersion);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<h3 id="versionCode和versionName"><a href="#versionCode和versionName" class="headerlink" title="versionCode和versionName"></a>versionCode和versionName</h3><p>versionCode，APP内部版本号，一般用于App升级。</p>
<p>versionName，App应用的版本名称，用户可以看到，就是我们发布的版本。</p>
<p>实际是调用DefaultProductFlavor中的方法<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Sets the version code.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> versionCode the version code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the flavor object</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ProductFlavor <span class="title">setVersionCode</span><span class="params">(Integer versionCode)</span> </span>&#123;</span><br><span class="line">    mVersionCode = versionCode;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Sets the version name.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> versionName the version name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the flavor object</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ProductFlavor <span class="title">setVersionName</span><span class="params">(String versionName)</span> </span>&#123;</span><br><span class="line">    mVersionName = versionName;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>versionCode 和 versionName区别，参考：<br><a href="https://github.com/fanshanhong/note/blob/master/Android/versionName%E5%92%8CversionCode.md" target="_blank" rel="noopener">https://github.com/fanshanhong/note/blob/master/Android/versionName%E5%92%8CversionCode.md</a></p>
<h3 id="signingConfig"><a href="#signingConfig" class="headerlink" title="signingConfig"></a>signingConfig</h3><p>配置默认的签名信息，对生成的APK进行签名。它是DefaultProductFlavor的属性<code>private SigningConfig mSigningConfig;</code>。我们对它进行配置的时候，实际是调用了 set方法。<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Signing config used by this product flavor.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SigningConfig <span class="title">getSigningConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mSigningConfig;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Sets the signing configuration. e.g.: &#123;<span class="doctag">@code</span> signingConfig signingConfigs.myConfig&#125; */</span></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ProductFlavor <span class="title">setSigningConfig</span><span class="params">(SigningConfig signingConfig)</span> </span>&#123;</span><br><span class="line">    mSigningConfig = signingConfig;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<h2 id="配置签名信息"><a href="#配置签名信息" class="headerlink" title="配置签名信息"></a>配置签名信息</h2><p>一般，App有Debug和Release两种模式。</p>
<p>debug模式的签名，是Android SDK 给我们提供的默认的，放在 $HOME/.android/debug.keystore</p>
<p>release默认的签名，要我们自己配置。</p>
<p>Android Extension 提供了 signingConfigs{} 便于我们配置多个签名。</p>
<p>看过之前的 Extension相关内容，我们知道， signingConfigs 就是 android（AppExtension） 的一个方法 signingConfigs(…)，方法里面是： action.execute(…)。这样才能生成一个嵌套的Extension。</p>
<p>我们去看一下源代码中是不是这样实现的：</p>
<p>BaseExtension.java中<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Encapsulates signing configurations that you can apply to &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * com.android.build.gradle.internal.dsl.BuildType&#125; and &#123;<span class="doctag">@link</span> ProductFlavor&#125; configurations.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;For more information about the properties you can configure in this block, see &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * SigningConfig&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">signingConfigs</span><span class="params">(Action&lt;? <span class="keyword">super</span> NamedDomainObjectContainer&lt;SigningConfig&gt;&gt; action)</span> </span>&#123;</span><br><span class="line">    checkWritability();</span><br><span class="line">    action.execute(signingConfigs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>下面代码可以看到， signingConfigs 类型是 NamedDomainObjectContainer， 也就是个容器，这样我们在 signingConfigs{} 块中定义的都是一个一个的SignConfig对象。一个SigningConfig对象就是一个签名配置。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> NamedDomainObjectContainer&lt;SigningConfig&gt; signingConfigs;</span><br></pre></td></tr></table></figure></div>
<p>因为 这里是 NamedDomainObjectContainer，所有 SigningConfig 的构造必须制定name， 且只能存在一个参数的构造，我们看一下：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * DSL object for configuring signing configs.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SigningConfig</span> <span class="keyword">extends</span> <span class="title">DefaultSigningConfig</span> <span class="keyword">implements</span> <span class="title">Serializable</span>, <span class="title">Named</span>,</span></span><br><span class="line"><span class="class">        <span class="title">CoreSigningConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a SigningConfig with a given name.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name the name of the signingConfig.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SigningConfig</span><span class="params">(@NonNull String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div></p>
<p>SigningConfig 可配置的元素如下：</p>
<ul>
<li>storeFile 签名文件证书</li>
<li>storePassword 签名证书文件密码</li>
<li>storeType 签名证书类型</li>
<li>keyAlias 签名证书中密钥别名</li>
<li>keyPassword 密钥密码</li>
</ul>
<p>这几个元素都是 SigningConfig的属性，配置的时候其实是调用对应的set方法：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SigningConfig</span> <span class="keyword">extends</span> <span class="title">DefaultSigningConfig</span> <span class="keyword">implements</span> <span class="title">Serializable</span>, <span class="title">Named</span>,</span></span><br><span class="line"><span class="class">        <span class="title">CoreSigningConfig</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>DefaultSigningConfig.java<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> DefaultSigningConfig <span class="title">setStorePassword</span><span class="params">(String storePassword)</span> </span>&#123;</span><br><span class="line">       mStorePassword = storePassword;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="meta">@Nullable</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getKeyAlias</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> mKeyAlias;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@NonNull</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> DefaultSigningConfig <span class="title">setKeyAlias</span><span class="params">(String keyAlias)</span> </span>&#123;</span><br><span class="line">       mKeyAlias = keyAlias;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="meta">@Nullable</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getKeyPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> mKeyPassword;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@NonNull</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> DefaultSigningConfig <span class="title">setKeyPassword</span><span class="params">(String keyPassword)</span> </span>&#123;</span><br><span class="line">       mKeyPassword = keyPassword;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="meta">@Nullable</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getStoreType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> mStoreType;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@NonNull</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> DefaultSigningConfig <span class="title">setStoreType</span><span class="params">(String storeType)</span> </span>&#123;</span><br><span class="line">       mStoreType = storeType;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></div></p>
<p>现在我们配置2个签名。<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">   signingConfigs &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            keyAlias <span class="string">'keyalias'</span></span><br><span class="line">            keyPassword <span class="string">'456'</span></span><br><span class="line">            storeFile file(<span class="string">'xx.keystore'</span>)</span><br><span class="line">            storePassword <span class="string">'123'</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        debug &#123;</span><br><span class="line">            keyAlias <span class="string">'keyalias-debug'</span></span><br><span class="line">            keyPassword <span class="string">'456'</span></span><br><span class="line">            storeFile file(<span class="string">'xx-debug.keystore'</span>)</span><br><span class="line">            storePassword <span class="string">'123'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>现在只是生成了两个SignConfig实例，一个变量名是 release，一个变量名是 debug。如果需要使用，直接引用即可。比如在 defaultConfig中可以配置 signingConfig</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">   defaultConfig &#123;</span><br><span class="line">      signingConfig signingConfigs.debug</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>调用的方法原型是 defaultConfig 中的  setSigningConfig方法<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ProductFlavor <span class="title">setSigningConfig</span><span class="params">(SigningConfig signingConfig)</span> </span>&#123;</span><br><span class="line">    mSigningConfig = signingConfig;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>上面可以看到，我们在 defaultConfig 中对签名配置的使用，这里<code>signingConfig signingConfigs.debug</code>中的signingConfigs 实际是 android(AppExtesion/BaseExtension)的一个属性，对应的方法是 getSigningConfigs()。</p>
<p>BaseExtension.java<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** &#123;<span class="doctag">@inheritDoc</span>&#125; */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> NamedDomainObjectContainer&lt;SigningConfig&gt; <span class="title">getSigningConfigs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> signingConfigs;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></div></p>
<p>现在我们把下面这个代码用Java写一下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">   defaultConfig &#123;</span><br><span class="line">      signingConfig signingConfigs.debug</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>等价于：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig.setSigningConfig(android.getSigningConfigs().get(<span class="string">'debug'</span>))</span><br></pre></td></tr></table></figure></div>
<p>除了在 defaultConfig中指定签名信息，还可以对构建的类型分别指定签名信息。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">   buildTypes &#123;</span><br><span class="line">      release &#123;</span><br><span class="line">         signingConfig signConfigs.release</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      debug &#123;</span><br><span class="line">          signingConfig signConfigs.debug</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="buildType"><a href="#buildType" class="headerlink" title="buildType"></a>buildType</h2><p>buildTypes 用于指定不同的构建类型。在Android Gradle中，帮我们内置了 debug 和 release 两个构建类型。如果想增加新的构建类型，在 buildTypes{}中继续添加新的元素即可。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">    release &#123;</span><br><span class="line">        minifyEnabled <span class="literal">false</span></span><br><span class="line">        proguardFiles getDefaultProguardFile(<span class="string">'proguard-android-optimize.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">        signingConfig signingConfigs.release</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    debug &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    release222 &#123;</span><br><span class="line">        signingConfig signingConfigs.debug</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>buildTypes 是android(AppExtension/BaseExtension)一个 属性。类型是：NamedDomainObjectContainer ，就是一个集合，里面配置一个一个的 BuildType对象。</p>
<p>BaseExtension.java</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> NamedDomainObjectContainer&lt;BuildType&gt; buildTypes;</span><br></pre></td></tr></table></figure></div>
<p>NamedDomainObjectContainer参考：<a href="https://github.com/fanshanhong/note/blob/master/Gradle/6.%20NamedDomainObjectContainer%E8%AF%A6%E8%A7%A3.md" target="_blank" rel="noopener">https://github.com/fanshanhong/note/blob/master/Gradle/6.%20NamedDomainObjectContainer%E8%AF%A6%E8%A7%A3.md</a></p>
<p>那，在 BuildType对象中，有哪些可以配置呢。我们知道，配置，其实要么就是调用对应的方法，或者调用属性的set方法。我们看下源码</p>
<h3 id="BuildType-java提供的属性"><a href="#BuildType-java提供的属性" class="headerlink" title="BuildType.java提供的属性"></a>BuildType.java提供的属性</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuildType</span> <span class="keyword">extends</span> <span class="title">DefaultBuildType</span> <span class="keyword">implements</span> <span class="title">CoreBuildType</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@NonNull</span> <span class="keyword">private</span> <span class="keyword">final</span> NdkOptions ndkConfig;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> com.android.build.gradle.internal.dsl.JavaCompileOptions javaCompileOptions;</span><br><span class="line">    <span class="meta">@Nullable</span> <span class="keyword">private</span> PostProcessingConfiguration postProcessingConfiguration;</span><br><span class="line">    <span class="meta">@Nullable</span> <span class="keyword">private</span> String postProcessingDslMethodUsed;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> shrinkResources = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> Boolean useProguard = <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>可以看到，能配置的属性有一些常用的：javaCompileOptions、shrinkResources</p>
<h4 id="javaCompileOptions"><a href="#javaCompileOptions" class="headerlink" title="javaCompileOptions"></a>javaCompileOptions</h4><p>参考Java编译选项</p>
<h4 id="shrinkResources"><a href="#shrinkResources" class="headerlink" title="shrinkResources"></a>shrinkResources</h4><p>配置是否自动清理未使用的资源，默认false，方法原型<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShrinkResources</span><span class="params">(<span class="keyword">boolean</span> shrinkResources)</span> </span>&#123;</span><br><span class="line">    checkPostProcessingConfiguration(PostProcessingConfiguration.OLD_DSL, <span class="string">"setShrinkResources"</span>);</span><br><span class="line">    <span class="keyword">this</span>.shrinkResources = shrinkResources;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<h3 id="父类DefaultBuildType-java提供的属性"><a href="#父类DefaultBuildType-java提供的属性" class="headerlink" title="父类DefaultBuildType.java提供的属性"></a>父类DefaultBuildType.java提供的属性</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultBuildType</span> <span class="keyword">extends</span> <span class="title">BaseConfigImpl</span> <span class="keyword">implements</span> <span class="title">BuildType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String mName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mDebuggable = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mJniDebuggable = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mRenderscriptDebuggable = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mRenderscriptOptimLevel = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mMinifyEnabled = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> SigningConfig mSigningConfig = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mEmbedMicroApp = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mZipAlignEnabled = <span class="keyword">true</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DefaultBuildType</span><span class="params">(@NonNull String name)</span> </span>&#123;</span><br><span class="line">        mName = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>可以看到，能配置的属性有一些常用的：mDebuggable、mJniDebuggable、mMinifyEnabled、mSigningConfig、mZipAlignEnabled</p>
<h4 id="mDebuggable"><a href="#mDebuggable" class="headerlink" title="mDebuggable"></a>mDebuggable</h4><p>用于配置是否生成一个可供调试的 apk。值为false或者true。方法原型:<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Whether this build type should generate a debuggable apk. */</span></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BuildType <span class="title">setDebuggable</span><span class="params">(<span class="keyword">boolean</span> debuggable)</span> </span>&#123;</span><br><span class="line">    mDebuggable = debuggable;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>因此，我们写的时候就是下面这样，他就自动会去调用 setDebuggable方法了<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">main &#123;</span><br><span class="line">   debuggable true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<h4 id="mJniDebuggable"><a href="#mJniDebuggable" class="headerlink" title="mJniDebuggable"></a>mJniDebuggable</h4><p>用于配置是否生成一个供调试的JNI代码的APK</p>
<p>方法原型为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Whether this build type is configured to generate an APK with debuggable native code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BuildType <span class="title">setJniDebuggable</span><span class="params">(<span class="keyword">boolean</span> jniDebugBuild)</span> </span>&#123;</span><br><span class="line">    mJniDebuggable = jniDebugBuild;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h4 id="mMinifyEnabled"><a href="#mMinifyEnabled" class="headerlink" title="mMinifyEnabled"></a>mMinifyEnabled</h4><p>用于配置该BuildType 是否启用 Proguard混淆，方法原型为：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Whether Minify is enabled for this build type. */</span></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BuildType <span class="title">setMinifyEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</span><br><span class="line">    mMinifyEnabled = enabled;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<h4 id="mSigningConfig"><a href="#mSigningConfig" class="headerlink" title="mSigningConfig"></a>mSigningConfig</h4><p>可以单独为某一个BuildType指定一个签名配置。对应的方法原型：<br>DefaultBuildType.java<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Sets the signing configuration. e.g.: &#123;<span class="doctag">@code</span> signingConfig signingConfigs.myConfig&#125; */</span></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BuildType <span class="title">setSigningConfig</span><span class="params">(@Nullable SigningConfig signingConfig)</span> </span>&#123;</span><br><span class="line">    mSigningConfig = signingConfig;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<h4 id="mZipAlignEnabled"><a href="#mZipAlignEnabled" class="headerlink" title="mZipAlignEnabled"></a>mZipAlignEnabled</h4><p>zipAlign是Android Gradle 为我们提供的 整理优化 APK文件的工具，能够提高系统和应用的运行效率，更快的读写apk中的资源，降低内存使用。所以app发布前，一定要使用zipAlign优化一下。</p>
<p>配置 zipAlignEnabled 为true<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">   buildTypes &#123;</span><br><span class="line">      release &#123;</span><br><span class="line">         zipAlignEnabled <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>对应的方法原型<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Whether zipalign is enabled for this build type. */</span></span><br><span class="line">  <span class="meta">@NonNull</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> BuildType <span class="title">setZipAlignEnabled</span><span class="params">(<span class="keyword">boolean</span> zipAlign)</span> </span>&#123;</span><br><span class="line">      mZipAlignEnabled = zipAlign;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div></p>
<h3 id="在-父类BaseConfigImpl中，还有一些属性"><a href="#在-父类BaseConfigImpl中，还有一些属性" class="headerlink" title="在 父类BaseConfigImpl中，还有一些属性"></a>在 父类BaseConfigImpl中，还有一些属性</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An object that contain a BuildConfig configuration</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseConfigImpl</span> <span class="keyword">implements</span> <span class="title">Serializable</span>, <span class="title">BaseConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ClassField&gt; mBuildConfigFields = Maps.newTreeMap();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ClassField&gt; mResValues = Maps.newTreeMap();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;File&gt; mProguardFiles = Lists.newArrayList();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;File&gt; mConsumerProguardFiles = Lists.newArrayList();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;File&gt; mTestProguardFiles = Lists.newArrayList();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; mManifestPlaceholders = Maps.newHashMap();</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> Boolean mMultiDexEnabled;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> File mMultiDexKeepProguard;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> File mMultiDexKeepFile;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h4 id="mProguardFiles"><a href="#mProguardFiles" class="headerlink" title="mProguardFiles"></a>mProguardFiles</h4><p>配置该BuildTpe使用的混淆配置文件。提供了两个方法： proguardFile()用于指定一个配置文件； proguardFiles()可以指定多个配置文件。方法原型如下：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds a new ProGuard configuration file.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;&lt;code&gt;proguardFile getDefaultProguardFile('proguard-android.txt')&lt;/code&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;There are 2 default rules files</span></span><br><span class="line"><span class="comment"> * &lt;ul&gt;</span></span><br><span class="line"><span class="comment"> *     &lt;li&gt;proguard-android.txt</span></span><br><span class="line"><span class="comment"> *     &lt;li&gt;proguard-android-optimize.txt</span></span><br><span class="line"><span class="comment"> * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;They are located in the SDK. Using &lt;code&gt;getDefaultProguardFile(String filename)&lt;/code&gt; will return the</span></span><br><span class="line"><span class="comment"> * full path to the files. They are identical except for enabling optimizations.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BuildType <span class="title">proguardFile</span><span class="params">(@NonNull Object proguardFile)</span> </span>&#123;</span><br><span class="line">    checkPostProcessingConfiguration(PostProcessingConfiguration.OLD_DSL, <span class="string">"proguardFile"</span>);</span><br><span class="line">    getProguardFiles().add(project.file(proguardFile));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds new ProGuard configuration files.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;There are 2 default rules files</span></span><br><span class="line"><span class="comment"> * &lt;ul&gt;</span></span><br><span class="line"><span class="comment"> *     &lt;li&gt;proguard-android.txt</span></span><br><span class="line"><span class="comment"> *     &lt;li&gt;proguard-android-optimize.txt</span></span><br><span class="line"><span class="comment"> * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;They are located in the SDK. Using &lt;code&gt;getDefaultProguardFile(String filename)&lt;/code&gt; will return the</span></span><br><span class="line"><span class="comment"> * full path to the files. They are identical except for enabling optimizations.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BuildType <span class="title">proguardFiles</span><span class="params">(@NonNull Object... files)</span> </span>&#123;</span><br><span class="line">    checkPostProcessingConfiguration(PostProcessingConfiguration.OLD_DSL, <span class="string">"proguardFiles"</span>);</span><br><span class="line">    <span class="keyword">for</span> (Object file : files) &#123;</span><br><span class="line">        proguardFile(file);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>我们常常写的形式是：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">release &#123;</span><br><span class="line">            minifyEnabled <span class="literal">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android-optimize.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></div></p>
<p>getDefaultProguardFile() 方法，是 android(也就是AppExtension/BaseExtension)对象提供的方法。写全了是这样的： android.getDefaultProguardFile()，它的作用是获取Android SDK安装目录中， Android 为我们提供的默认的Proguard混淆配置文件， 路径是 Android SDK安装目录下的 tools/proguard。代码实现:</p>
<p>BaseExtension.java<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> File <span class="title">getDefaultProguardFile</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!ProguardFiles.KNOWN_FILE_NAMES.contains(name)) &#123;</span><br><span class="line">        extraModelInfo</span><br><span class="line">                .getSyncIssueHandler()</span><br><span class="line">                .reportError(</span><br><span class="line">                        EvalIssueReporter.Type.GENERIC,</span><br><span class="line">                        <span class="keyword">new</span> EvalIssueException(ProguardFiles.UNKNOWN_FILENAME_MESSAGE));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ProguardFiles.getDefaultProguardFile(name, project);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>从实现中可以看到，我们只要传递一个文件名给这个方法，就返回 tools/proguard下的文件。</p>
<p>Android SDK 为我们默认提供了两个Proguard配置文件。分别是：proguard-android.txt 和 proguard-android.optimize.txt。一个是没优化的，一个是优化的。</p>
<p>除了在BuildType中指定混淆，在defaultConfig中也可以指定。多渠道包 ProductFlavor也可以指定。</p>
<h4 id="mManifestPlaceholders"><a href="#mManifestPlaceholders" class="headerlink" title="mManifestPlaceholders"></a>mManifestPlaceholders</h4><p>参考动态配置 AndroidManifest 文件</p>
<h4 id="mMultiDexEnabled"><a href="#mMultiDexEnabled" class="headerlink" title="mMultiDexEnabled"></a>mMultiDexEnabled</h4><p>配置该 BuildType 是否启用自动查分多个Dex的功能。方法原型为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMultiDexEnabled</span><span class="params">(@Nullable Boolean multiDex)</span> </span>&#123;</span><br><span class="line">    mMultiDexEnabled = multiDex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="使用混淆"><a href="#使用混淆" class="headerlink" title="使用混淆"></a>使用混淆</h2><p>步骤：</p>
<ol>
<li>minifyEnabled 设置为 true</li>
<li>配置 proguardFile 或者 proguardFiles</li>
</ol>
<p>这两个属性，在buildType 和 defaultConfig里都可以配置的<br>TIP：个人觉得，最好把它写到一个BuildType里，对一个BuildType生效，比如release。不要放在defaultConfig里。如果放在defaultConfig里，设置开启，并且在 debug 里没显示关闭，那在调试的时候，偶尔可能会有问题。</p>
<h2 id="共享库"><a href="#共享库" class="headerlink" title="共享库"></a>共享库</h2><p>Android 的包，比如android.app，android.content，android.view，是默认就包含在Android SDK里的，所有的应用都可以直接使用，系统会帮我们自动连接并找到他们。还有一些库，比如com.google.android.maps，android.test.runner等，这些库是独立的，不会被系统自动链接，如果要使用，就要单独生成，我们成为共享库。</p>
<p>在 Android.Manifest文件中，可以指定要使用的库</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;use-library</span><br><span class="line"><span class="symbol">   android:</span>name=<span class="string">"com.google.android.maps"</span></span><br><span class="line"><span class="symbol">   android:</span>required=<span class="string">"true"</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></div>
<p>这样就声明了我们要使用maps这个库。声明之后，在安装APK的时候，系统会根据我们的定义，帮助检测手机系统是否有需要的共享库。<code>required=true</code>，表示如果系统没有这个库，就不能正常安装。</p>
<p>在Android中，除了标准SDK，还有两种库</p>
<ul>
<li>add-ons</li>
<li>optional，位于 platforms/android-xx/optional目录，一般是为了兼容旧版本的API，比如 org.apache.http.legacy。这是一个Http库，从API23开始，标准SDK不再包含 HttpClient库。如果想要使用 HttpClient，就需要使用 org.apache.http.legacy 这个库。</li>
</ul>
<p>Android 提供了 useLibrary 这个方法。让我们可以把一个库添加到 classpath中，然后就可以在代码中使用了</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">29</span></span><br><span class="line">    buildToolsVersion <span class="string">"29.0.2"</span></span><br><span class="line">    useLibrary <span class="string">'org.apache.http.legacy'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>最好也在 AndroidManifest文件中配置一下uses-library，防止出现问题。</p>
<h2 id="批量修改APK文件名"><a href="#批量修改APK文件名" class="headerlink" title="批量修改APK文件名"></a>批量修改APK文件名</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">android.applicationVariants.all &#123;</span><br><span class="line">    variant -&gt;</span><br><span class="line">        variant.outputs.each &#123; output -&gt;</span><br><span class="line">           <span class="comment">// 修改APK文件的输出路径。如果是父目录，可以 project.rootDir.parent这样写</span></span><br><span class="line">            variant.getPackageApplicationProvider().get().outputDirectory = <span class="keyword">new</span> File(project.rootDir.absolutePath + <span class="string">"/output_apk"</span>)</span><br><span class="line">            println <span class="string">"==============path:$&#123;project.rootDir.absolutePath&#125;"</span></span><br><span class="line">            <span class="comment">//variant.getPackageApplicationProvider().get().outputDirectory = new File(project.rootDir.absolutePath + "/oooo_$&#123;variant.productFlavors[0].name&#125;")</span></span><br><span class="line">            <span class="keyword">def</span> outputFile = output.outputFile</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (outputFile != <span class="literal">null</span> &amp;&amp; outputFile.name.endsWith(<span class="string">'.apk'</span>)) &#123;</span><br><span class="line"></span><br><span class="line">                 <span class="comment">// 修改输出文件名字。</span></span><br><span class="line">                <span class="keyword">def</span> name = <span class="string">"v$&#123;defaultConfig.versionName&#125;_$&#123;variant.productFlavors[0].name&#125;_$&#123;buildType.name&#125;.apk"</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//output.outputFile = new File(outputFile.parent, name)</span></span><br><span class="line">                output.outputFileName = output.outputFile.name.replace(<span class="string">"app"</span>, name)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>注意：在 Flutter 1.9.1 版本中，无法该更APK的输出路径和文件名。<br>Flutter 高版本可以。</p>
<h2 id="修改-build-目录"><a href="#修改-build-目录" class="headerlink" title="修改 build 目录"></a>修改 build 目录</h2><p>直接修改project的buildDir属性即可：</p>
<p>app/build.gradle中<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">project.buildDir = project.rootDir.absolutePath + <span class="string">"/xxxx"</span></span><br></pre></td></tr></table></figure></div></p>
<p>这样就把之前的build目录全部迁移到了 xxxx 目录下</p>
<h2 id="版本信息统一管理"><a href="#版本信息统一管理" class="headerlink" title="版本信息统一管理"></a>版本信息统一管理</h2><p>每个应用都有一个版本，版本一般由三部分组成：major.minor.patch，第一个是主版本号，第二个是副版本号，第三个是补丁号，如 1.0.0 这种格式的版本号，在 Android 开发中最原始的版本配置方式就是在 build.gradle 中在 defaultConfig 中配置对应的版本号和版本名称，参考如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//最原始的版本配置方式</span></span><br><span class="line">android&#123;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">"1.0"</span></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>实际开发中一般将这种版本相关的信息单独定义在一个独立的版本管理文件中进行统一管理，定义 version.gradle 文件如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ext&#123;</span><br><span class="line">    <span class="comment">//应用版本号、版本名称</span></span><br><span class="line">    appversionCode = <span class="number">1</span></span><br><span class="line">    appVersionName = <span class="string">"1.0"</span></span><br><span class="line">    <span class="comment">//其他版本号...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>然后在 build.gradle 中使用 version.gradle 文件中定义的版本号、版本名称即可，参考如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入version.gradle文件</span></span><br><span class="line">apply <span class="string">from:</span> <span class="string">"version.gradle"</span></span><br><span class="line">android &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        <span class="comment">//使用version.gradle里定义的版本号</span></span><br><span class="line">        versionCode appversionCode</span><br><span class="line">        <span class="comment">//使用version.gradle里定义的版本名称</span></span><br><span class="line">        versionName appVersionName</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="动态配置-AndroidManifest-文件"><a href="#动态配置-AndroidManifest-文件" class="headerlink" title="动态配置 AndroidManifest 文件"></a>动态配置 AndroidManifest 文件</h2><p>动态配置 AndroidManifest 配置就是动态的去修改 AndroidManifest 文件中的一些内容，如友盟等第三方统计平台分析统计的时候，一般会要求要在 AndroidManifest 文件中指定渠道名称，如下所示：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">android:value</span>=<span class="string">"CHANNEL_ID"</span> <span class="attr">android:name</span>=<span class="string">"CHANNEL"</span>/&gt;</span></span><br></pre></td></tr></table></figure></div>
<p>这里 CHANNEL_ID 要替换成不同渠道的名称，如 baidu、miui 等各个渠道名称，那么如何动态的修改这些变化的参数呢，这里需要用到 Manifest 占位符和 manifestPlaceholder，manifestPlaceholder 是 ProductFlavor 的一个属性，是一个 Map 类型，可以配置多个占位符，具体代码参考如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">android&#123;</span><br><span class="line">    <span class="comment">//维度</span></span><br><span class="line">    flavorDimensions <span class="string">"channel"</span></span><br><span class="line">    productFlavors&#123;</span><br><span class="line">        miui&#123;</span><br><span class="line">            dimension <span class="string">"channel"</span></span><br><span class="line">            manifestPlaceholders.put(<span class="string">"CHANNEL"</span>,<span class="string">"miui"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        baidu&#123;</span><br><span class="line">            dimension <span class="string">"channel"</span></span><br><span class="line">            manifestPlaceholders.put(<span class="string">"CHANNEL"</span>,<span class="string">"baidu"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>上述代码中配置了 flavorDimensions 属性，这个属性可以理解为维度，比如 release 和 debug 是一个维度、不同的渠道是一个维度、免费版本还是付费版本又是一个维度，如果这三个维度都要考虑，那么生成 Apk 的格式就是 2 <em> 2 </em> 2 总共 8 个不同的 Apk，从 Gradle 3.0 开始不管是一个维度还是多个维度，都必须使用 flavorDimensions 来约束，上面代码中定义了一个维度 channel，再加上 buildType 中的 debug 和 release ，故此时生成不同 Apk 的个数是 4 个。</p>
<p>当然，如果没有配置 flavorDimensions 则会出现如下错误，具体如下：</p>
<blockquote>
<p>Error:All flavors must now belong to a named flavor dimension.</p>
</blockquote>
<p>实际开发中根据实际情况配置对应的 flavorDimensions 即可。</p>
<p>然后，在 AndroidManifest 文件中使用占位符介绍打包时传递过来的参数，在 AndroidManifest 文件中添加 如下：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta-data android:value=&quot;$&#123;CHANNEL&#125;&quot; android:name=&quot;channel&quot;/&gt;</span><br></pre></td></tr></table></figure></div></p>
<p>最后，执行对应的渠道包任务，如执行 assembleBaiduRelease 将会将 AndroidManifest 中的渠道替换成 baidu，可使用命令执行也可使用 Android Studio 选择对应的 task 来执行，执行命令如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">gradle</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight gradle"><figcaption><span>assembleBaiduRelease```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">选择对应的 <span class="keyword">task</span> 执行就会生成对应的 Apk，使用 Android Killer 反编译打开生成的 Apk ，查看 AndroidManifest 文件如下：</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span> standalone=<span class="string">"no"</span>?&gt;</span><br><span class="line">&lt;manifest xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span> <span class="keyword">package</span>=<span class="string">"com.manu.androidgradleproject"</span>&gt;</span><br><span class="line">    &lt;application android:allowBackup=<span class="string">"true"</span> android:icon=<span class="string">"@mipmap/ic_launcher"</span> android:label=<span class="string">"@string/app_name"</span> android:supportsRtl=<span class="string">"true"</span> android:theme=<span class="string">"@style/AppTheme"</span> roundIcon=<span class="string">"@mipmap/ic_launcher_round"</span>&gt;</span><br><span class="line">        &lt;!--AndroidManifest文件修改成功--&gt;</span><br><span class="line">        &lt;meta-data android:name=<span class="string">"channel"</span> android:value=<span class="string">"baidu"</span><span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">        &lt;activity android:name="com.manu.androidgradleproject.MainActivity"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;intent-filter&gt;</span></span><br><span class="line"><span class="regexp">                &lt;action android:name="android.intent.action.MAIN"/</span>&gt;</span><br><span class="line">                &lt;category android:name=<span class="string">"android.intent.category.LAUNCHER"</span><span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/i</span>ntent-filter&gt;</span><br><span class="line">        &lt;<span class="regexp">/activity&gt;</span></span><br><span class="line"><span class="regexp">        &lt;meta-data android:name="android.support.VERSION" android:value="26.1.0"/</span>&gt;</span><br><span class="line">        &lt;meta-data android:name=<span class="string">"android.arch.lifecycle.VERSION"</span> android:value=<span class="string">"27.0.0-SNAPSHOT"</span><span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>application&gt;</span><br><span class="line">&lt;<span class="regexp">/manifest&gt;</span></span><br></pre></td></tr></table></figure></div>
<p>上述案列中，渠道的名称是一致的，可以通过遍历很方便的完成渠道名称的替换，参考如下：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">productFlavors.all&#123; flavor -&gt;</span><br><span class="line">    manifestPlaceholders.put(<span class="string">"CHANNEL"</span>,name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<h2 id="自定义BuildConfig"><a href="#自定义BuildConfig" class="headerlink" title="自定义BuildConfig"></a>自定义BuildConfig</h2><p>BuildConfig 是一个在 Android Gradle 构建脚本编译后生成的类，默认构建生成的 BuildConfig 内容如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Automatically generated file. DO NOT MODIFY</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> com.manu.androidgradleproject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BuildConfig</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> DEBUG = <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APPLICATION_ID = <span class="string">"com.manu.androidgradleproject"</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String BUILD_TYPE = <span class="string">"release"</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FLAVOR = <span class="string">"baidu"</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> VERSION_CODE = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String VERSION_NAME = <span class="string">"1.0"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>上面 BuildConfig 中的一些常量都是关于应用的一些关键信息，其中 DEBUG 在 debug 模式下为 true，release 模式下为 false，此外还有应用包名、构建类型、构建渠道、版本号及版本名称，所以如果开发中需要用到这些值可以在 BuildConfig 中直接获取，比如包名的获取一般是 context.getPackageName()，如果直接从 BuildConfig 中获取是不是不仅方便而且有利于应用性能提升，所以，可在构建时在该文件中添加一些额外的有用的信息，可以使用 buildConfigField 方法，具体如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * type:生成字段的类型</span></span><br><span class="line"><span class="comment"> * name:生成字段的常量名称</span></span><br><span class="line"><span class="comment"> * value:生成字段的常量值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildConfigField</span><span class="params">(String type, String name, String value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>下面使用 buildConfigField 方法为每个渠道配置一个相关地址，参考如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">android&#123;</span><br><span class="line">    <span class="comment">//维度</span></span><br><span class="line">    flavorDimensions <span class="string">"channel"</span></span><br><span class="line">    productFlavors&#123;</span><br><span class="line">        miui&#123;</span><br><span class="line">            dimension <span class="string">"channel"</span></span><br><span class="line">            manifestPlaceholders.put(<span class="string">"CHANNEL"</span>,<span class="string">"miui"</span>)</span><br><span class="line">            buildConfigField <span class="string">'String'</span> ,<span class="string">'URL'</span>,<span class="string">'"http://www.miui.com"'</span></span><br><span class="line">        &#125;</span><br><span class="line">        baidu&#123;</span><br><span class="line">            dimension <span class="string">"channel"</span></span><br><span class="line">            manifestPlaceholders.put(<span class="string">"CHANNEL"</span>,<span class="string">"baidu"</span>)</span><br><span class="line">            <span class="comment">//buildConfigField方法参数value中的内容是单引号中的，如果value是String，则String的双引号不能省略</span></span><br><span class="line">            buildConfigField <span class="string">'String'</span> ,<span class="string">'WEB_URL'</span>,<span class="string">'"http://www.baidu.com"'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>再打包时就会自动生成添加的字段，构建完成后查看 BuildConfig 文件，生成了上面添加的字段，参考如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Automatically generated file. DO NOT MODIFY</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> com.manu.androidgradleproject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BuildConfig</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> DEBUG = <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APPLICATION_ID = <span class="string">"com.xx.xx"</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String BUILD_TYPE = <span class="string">"release"</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FLAVOR = <span class="string">"baidu"</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> VERSION_CODE = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String VERSION_NAME = <span class="string">""</span>;</span><br><span class="line">  <span class="comment">// Fields from product flavor: baidu</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String WEB_URL = <span class="string">"http://www.baidu.com"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="Java-编译选项"><a href="#Java-编译选项" class="headerlink" title="Java 编译选项"></a>Java 编译选项</h2><p>有时需对Java源代码的编码方式、Java的版本有要求，可以通过 compileOptions 方法来配置。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">   compileOptions &#123;</span><br><span class="line">        sourceCompatibility = <span class="string">'1.8'</span></span><br><span class="line">        targetCompatibility = <span class="string">'1.8'</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>android对象（AppExtension/BaseExtension）对象提供了一个 compileOptions方法，接受一个CompileOptions类型的闭包作为参数，对java编译选项进行配置</p>
<p>BaseExtension.java</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Specifies Java compiler options, such as the language level of the Java source code and</span></span><br><span class="line"><span class="comment"> * generated bytecode.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;For more information about the properties you can configure in this block, see &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * com.android.build.gradle.internal.CompileOptions&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">compileOptions</span><span class="params">(Action&lt;CompileOptions&gt; action)</span> </span>&#123;</span><br><span class="line">    checkWritability();</span><br><span class="line">    action.execute(compileOptions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>明显，这个方法是编写嵌套 Extension 的写法。</p>
<p>CompileOptions 是编译配置，提供三个属性<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompileOptions</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String VERSION_PREFIX = <span class="string">"VERSION_"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> JavaVersion sourceCompatibility;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> JavaVersion targetCompatibility;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> String encoding = Charsets.UTF_8.name();</span><br></pre></td></tr></table></figure></div></p>
<ul>
<li>sourceCompatibility 是配置Java源代码的编译的版本。<br>方法源码：<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@see</span> #getSourceCompatibility() */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSourceCompatibility</span><span class="params">(@NonNull Object sourceCompatibility)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.sourceCompatibility = convert(sourceCompatibility);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
</ul>
<p>可以看到，它接收一个 Object类型的参数，然后内部调用convert进行转换。看一下convert<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Converts all possible supported way of specifying a Java version to a &#123;<span class="doctag">@link</span> JavaVersion&#125;.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * 尽可能将所有支持的方式转换成JavaVersion对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> version the user provided java version.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaVersion <span class="title">convert</span><span class="params">(@NonNull Object version)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// for backward version reasons, we support setting strings like 'Version_1_6'</span></span><br><span class="line">    <span class="keyword">if</span> (version <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">        <span class="keyword">final</span> String versionString = (String) version;</span><br><span class="line">        <span class="keyword">if</span> (versionString.toUpperCase(Locale.ENGLISH).startsWith(VERSION_PREFIX)) &#123;</span><br><span class="line">            version = versionString.substring(VERSION_PREFIX.length()).replace(<span class="string">'_'</span>, <span class="string">'.'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JavaVersion.toVersion(version);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>这个convert方法，会尽可能将所有支持的方式转换成JavaVersion对象。下面我们列出可用的值：</p>
<ul>
<li>1.8</li>
<li>“1.8” 或者 ‘1.8’  都是String</li>
<li>JavaVersion.Version_1_8</li>
<li><p>Version_1_8</p>
</li>
<li><p>targetCompatibility 是配置生成的Java字节码的版本。</p>
</li>
</ul>
<h2 id="DEX选项配置"><a href="#DEX选项配置" class="headerlink" title="DEX选项配置"></a>DEX选项配置</h2><p>Android 中的源代码被编译成 class 字节码，在打包成 Apk 的时候又被 dx 命令优化成 Android 虚拟机可执行的 DEX 文件，DEX 格式的文件是专为 Android 虚拟机设计的，在一定程度上会提高其运行速度，默认情况下给 dx 分配的内存是 1024M，在 Android Gradle 中可以通过 dexOptions 的五个属性：incremental、javaMaxHeapSize、jumboMode、threadCount 和 preDexLibraries 来对 DEX 进行相关配置，具体参考如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    <span class="comment">//DEX选项配置</span></span><br><span class="line">    dexOptions &#123;</span><br><span class="line">        <span class="comment">//设置是否启用dx增量模式</span></span><br><span class="line">        incremental <span class="literal">true</span></span><br><span class="line">        <span class="comment">//设置执行dx命令为其分配的最大堆内存</span></span><br><span class="line">        javaMaxHeapSize <span class="string">'4g'</span></span><br><span class="line">        <span class="comment">//设置是否开启jumbo模式，如果项目方法数超过65535，需要开启jumbo模式才能构建成功</span></span><br><span class="line">        jumboMode <span class="literal">true</span></span><br><span class="line">        <span class="comment">//设置Android Gradle运行dx命令时使用的线程数量，可提高dx执行的效率</span></span><br><span class="line">        threadCount <span class="number">2</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 设置是否执行dex Libraries库工程,开启后会提高增量构建的速度，会影响clean的速度，默认为true</span></span><br><span class="line"><span class="comment">         * 使用dx的--multi-dex选项生成多个dex,为避免和库工程冲突，可设置为false</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        preDexLibraries <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>dexOptions 是 Android 提供的（AppExtension/BaseExtension）提供的。</p>
<p>BaseExtension.java<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> DexOptions dexOptions;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Specifies options for the DEX tool, such as enabling library pre-dexing.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;For more information about the properties you can configure in this block, see &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * DexOptions&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dexOptions</span><span class="params">(Action&lt;DexOptions&gt; action)</span> </span>&#123;</span><br><span class="line">    checkWritability();</span><br><span class="line">    action.execute(dexOptions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>显然，是作为一个嵌套的Extension形式，与我们上面的使用方式一致。</p>
<p>看看DexOptions配置项的方法原型：在 DexOptions.java 和 DefaultDexOptions.java中</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPreDexLibraries</span><span class="params">(<span class="keyword">boolean</span> preDexLibraries)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.preDexLibraries = preDexLibraries;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJumboMode</span><span class="params">(<span class="keyword">boolean</span> jumboMode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.jumboMode = jumboMode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIncremental</span><span class="params">(<span class="keyword">boolean</span> ignored)</span> </span>&#123;</span><br><span class="line">    deprecationReporter.reportObsoleteUsage(</span><br><span class="line">            <span class="string">"DexOptions.incremental"</span>, DeprecationTarget.DEX_OPTIONS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJavaMaxHeapSize</span><span class="params">(String javaMaxHeapSize)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.javaMaxHeapSize = javaMaxHeapSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setThreadCount</span><span class="params">(Integer threadCount)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.threadCount = threadCount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="自动清理未使用的资源"><a href="#自动清理未使用的资源" class="headerlink" title="自动清理未使用的资源"></a>自动清理未使用的资源</h2><p>Android 开发中打包 Apk 总是希望在相同功能的情况下 Apk 体积尽量小，那就要在打包之前删除没有使用的资源文件或打包时不将无用的资源打包到 Apk 中，可以使用 Android Lint 检查未使用的资源，但是无法清除一些第三方库中的无用资源，还可以使用 Resource Shrinking，可在打包之前检查资源，如果没有使用则不会被打包到 Apk 中，具体参考如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//自动清理未使用资源</span><br><span class="line">android&#123;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            //开启混淆，保证某些资源在代码中未被使用，以便于自动清理无用资源，两者配合使用</span><br><span class="line">            minifyEnabled true</span><br><span class="line">            /**</span><br><span class="line">             * 打包时会检查所有资源，如果没有被引用，则不会被打包到Apk中，会处理第三方库不使用的资源</span><br><span class="line">             * 默认不启用</span><br><span class="line">             */</span><br><span class="line">            shrinkResources true</span><br><span class="line">            //开启zipalign优化</span><br><span class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">        &#125;</span><br><span class="line">        debug&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>为防止有用资源未被打包到 Apk 中，Android Gradle 提供了 keep 方法来配置那些资源不被清理，在 res/raw/ 下新建一个 xml 文件来使用 keep 方法，参考如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--keep.xml文件--&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;resources xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    tools:keep=&quot;@layout/l_used*_c,@layout/l_used_a,@layout/l_used_b*&quot;</span><br><span class="line">    tools:discard=&quot;@layout/l_used&quot;</span><br><span class="line">    tools:shrinkMode=&quot;safe&quot;/&gt;</span><br></pre></td></tr></table></figure></div>
<p>可配置的三个属性：keep 表示要保留的资源文件，可使用以(,)分割的资源列表，可使用(*)作为通配符，discard 表示要移除的资源，和 keep 类似，shrinkMode 用于设置自动清理资源的模式，一般设置为 safe 即可，如果设置为 strict 则有可能清除可能会使用的资源。</p>
<p>此外，还可以使用 ProductFlavor 提供的方法 resConfigs 和 resConfig，可配置那些资源打包到 Apk 中，使用方式如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">android&#123;</span><br><span class="line">    defaultConfig&#123;</span><br><span class="line">       //参数可以是Android开发时的资源限定符</span><br><span class="line">        resConfigs &apos;zh&apos;</span><br><span class="line">        //...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>上述自动清理资源的方式只是不打包到 Apk 中，在实际的项目中并没有被清除，可通过日志查看哪些资源被清理了，然后决定要不要在项目中清除。</p>
<h2 id="突破65535方法限制"><a href="#突破65535方法限制" class="headerlink" title="突破65535方法限制"></a>突破65535方法限制</h2><p>在 Android 开发中总会遇到方法数大于 65535 时出现异常，那为什么会有这个限制呢，因为 Java 源文件被打包成一个 DEX 文件，这个文件是优化过的、可在 Dalvik 虚拟机上可执行的文件，由于 Dalvik 在执行 DEX 文件的时候，使用了 short 来索引 DEX 文件中的方法，这就意味着单个 DEX 文件可被定义的方法最多只有 65535 个。解决办法自然是当方法数超过 65535 个的时候创建多个 DEX 文件。</p>
<p>从 Android 5.0 开始的 Android 系统使用 ART 的运行方式，原生支持多个 DEX 文件，ART 在安装 App 的时候执行预编译，把多个 DEX 文件合并成一个 oat 文件执行，在 Android 5.0 之前，Dalvik 虚拟机只支持单个 DEX 文件，要想突破单个 DEX 方法数超过 65535 的限制，需使用 Multidex 库。</p>
<ol>
<li>Android Build Tools 最低版本 21.1</li>
<li><p>启用 multiDexEnabled </p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">   defaultConfig &#123;</span><br><span class="line">      multiDexEnabled <span class="literal">true</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>dependencies 中添加依赖</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.android.support:multidex:1.0.1&apos;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>继承自MultiDexApplication， 或者自定义 Application</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">SomeOtherApplication</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">attachBaseContext</span><span class="params">(Context base)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">super</span>.attachBaseContext(base);</span><br><span class="line">     MultiDex.install(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
</ol>
<h1 id="Android-Gradle-任务"><a href="#Android-Gradle-任务" class="headerlink" title="Android Gradle 任务"></a>Android Gradle 任务</h1><p>Android Gradle 插件是基于 Java 插件的，因此Android Gradle 插件包含了所有的Java插件提供的功能，包括 assemble， build 等。除此之外，Android还添加了install， lint等任务</p>
<p>常用的：</p>
<ul>
<li><p>connectedCheck 在所有的连接的设备或者模拟器上进行check检查</p>
</li>
<li><p>lint 在所有的ProductFlavor上运行 lint检查</p>
</li>
<li><p>assemble、assembleRelease、assembleDebug 打包构建</p>
</li>
<li><p>build</p>
</li>
<li><p>clean</p>
</li>
<li><p>install</p>
</li>
</ul>
<h1 id="守护进程"><a href="#守护进程" class="headerlink" title="守护进程"></a>守护进程</h1><p>gradle.properties文件中增加一行配置：</p>
<p>org.gradle.daemon=false</p>
<p>另外–daemon和–no-daemon命令可以在命令行下启用和禁用守护进程，而且这两个选项的优先度很高，及时配置了启用和禁用的属性这两个选项也可以即时生效。</p>
<p>完。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Fan shanhong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2021/01/28/Gradle/11.Android Gradle插件/">http://yoursite.com/2021/01/28/Gradle/11.Android Gradle插件/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Gradle/">Gradle    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2021/01/28/Gradle/10.Java Gradle插件/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Previous Post</div><div class="prev_info"><span>10.Java Gradle插件</span></div></a></div><div class="next-post pull_right"><a href="/2021/01/28/Gradle/9.Gradle插件/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>9.Gradle插件</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2021/01/28/Gradle/10.Java Gradle插件/" title="10.Java Gradle插件"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-01-28</div><div class="relatedPosts_title">10.Java Gradle插件</div></div></a></div><div class="relatedPosts_item"><a href="/2021/02/08/Gradle/12.Android transform/" title="12.Android transform"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-02-08</div><div class="relatedPosts_title">12.Android transform</div></div></a></div><div class="relatedPosts_item"><a href="/2019/03/08/Gradle/15.APK安装卸载过程/" title="15.APK安装卸载过程"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-03-08</div><div class="relatedPosts_title">15.APK安装卸载过程</div></div></a></div><div class="relatedPosts_item"><a href="/2019/03/08/Gradle/14.Android打包过程/" title="14.Android打包过程"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-03-08</div><div class="relatedPosts_title">14.Android打包过程</div></div></a></div><div class="relatedPosts_item"><a href="/2021/01/28/Gradle/9.Gradle插件/" title="9.Gradle插件"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-01-28</div><div class="relatedPosts_title">9.Gradle插件</div></div></a></div><div class="relatedPosts_item"><a href="/2021/01/23/Gradle/1.Gradle入门/" title="Gradle入门"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-01-23</div><div class="relatedPosts_title">Gradle入门</div></div></a></div></div><div class="clear_both"></div></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Fan shanhong</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script></body></html>